<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBAR - Ing√°s Blokkold√≥ Asszisztens Rendszer</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#9333ea">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        /* Login Screen Styles */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 50%, #fce7f3 100%);
            padding: 20px;
        }
        .login-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(147, 51, 234, 0.15);
            padding: 48px 40px;
            max-width: 440px;
            width: 100%;
            text-align: center;
        }
        .login-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #9333ea, #ec4899);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
        }
        .login-title {
            font-size: 1.75rem;
            color: #9333ea;
            margin-bottom: 8px;
            font-weight: 700;
        }
        .login-subtitle {
            color: #6b7280;
            margin-bottom: 32px;
            font-size: 0.95rem;
        }
        .login-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s;
            text-align: center;
            font-weight: 600;
            letter-spacing: 1px;
        }
        .login-input:focus {
            outline: none;
            border-color: #9333ea;
            box-shadow: 0 0 0 4px rgba(147, 51, 234, 0.1);
        }
        .login-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #9333ea, #ec4899);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(147, 51, 234, 0.3);
        }
        .login-error {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 0.9rem;
            display: none;
        }
        .login-error.show {
            display: block;
        }
        .app-container {
            display: none;
        }
        .app-container.active {
            display: block;
        }
        
        /* Original IBAR Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 50%, #fce7f3 100%);
            min-height: 100vh;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 24px;
            margin-bottom: 24px;
        }
        .header { text-align: center; }
        .header h1 { font-size: 2rem; color: #9333ea; margin-bottom: 8px; }
        .header p { color: #6b7280; font-size: 0.875rem; }
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
            margin-bottom: 16px;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #9333ea, #ec4899);
            transition: width 0.5s ease;
        }
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 4px;
            margin-top: 16px;
        }
        .step-icon {
            text-align: center;
            font-size: 1.25rem;
            transition: all 0.3s;
            cursor: pointer;
            padding: 8px 4px;
            border-radius: 8px;
        }
        .step-icon.active { 
            color: #9333ea; 
            font-weight: bold; 
            transform: scale(1.2); 
            background: #f3e8ff;
        }
        .step-icon.completed { color: #10b981; }
        .step-icon.pending { color: #9ca3af; }
        .content-card h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .info-box { padding: 16px; border-radius: 8px; margin-bottom: 24px; }
        .info-box.blue { background: #eff6ff; border-left: 4px solid #3b82f6; color: #1e40af; }
        .info-box.purple { background: #faf5ff; border-left: 4px solid #a855f7; color: #6b21a8; }
        .info-box.yellow { background: #fefce8; border: 1px solid #fde047; color: #854d0e; }
        .info-box.green { background: #f0fdf4; border: 1px solid #86efac; color: #15803d; }
        .question-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-weight: 600;
            color: #92400e;
        }
        .btn {
            width: 100%;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-purple { background: #9333ea; color: white; }
        .btn-purple:hover { background: #7e22ce; }
        .btn-secondary { background: #d1d5db; color: #374151; }
        .btn-secondary:hover { background: #9ca3af; }
        .btn-download { background: #8b5cf6; color: white; margin-top: 12px; }
        .btn-download:hover { background: #7c3aed; }
        .btn-skip { background: #fbbf24; color: #78350f; }
        .btn-skip:hover { background: #f59e0b; }
        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .diagram-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        .diagram-button {
            background: #faf5ff;
            border: 2px solid #d8b4fe;
            color: #6b21a8;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .diagram-button:hover { background: #f3e8ff; transform: translateY(-2px); }
        .diagram-button.selected { 
            background: #9333ea; 
            color: white; 
            border-color: #7e22ce;
        }
        .answer-display {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            text-align: left;
        }
        .answer-label {
            font-weight: 600;
            color: #6b21a8;
            margin-bottom: 4px;
        }
        .answer-value {
            color: #1f2937;
        }
        .slider-container {
            margin: 24px 0;
        }
        .slider-group {
            margin-bottom: 24px;
        }
        .slider-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #6b21a8;
            font-size: 1.1rem;
        }
        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .slider {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #9333ea;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #9333ea;
            cursor: pointer;
            border: none;
        }
        .slider-value {
            min-width: 50px;
            font-weight: bold;
            color: #9333ea;
            font-size: 1.2rem;
        }
        .generated-text {
            background: #f0fdf4;
            border: 2px solid #86efac;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            line-height: 1.8;
            white-space: pre-wrap;
            text-align: left;
            min-height: 200px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #d8b4fe;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        .summary-section {
            margin-top: 24px;
        }
        .summary-section h3 {
            color: #7e22ce;
            margin-bottom: 16px;
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5rem; }
            .btn-grid { grid-template-columns: 1fr; }
            .steps-grid { grid-template-columns: repeat(auto-fit, minmax(35px, 1fr)); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">üéØ</div>
            <h1 class="login-title">IBAR</h1>
            <p class="login-subtitle">Ing√°s Blokkold√≥ Asszisztens Rendszer</p>
            <input 
                type="text" 
                class="login-input" 
                id="accessCodeInput" 
                placeholder="IBAR-2025-XXX"
                maxlength="13"
            >
            <button class="login-button" onclick="checkAccess()">Bel√©p√©s</button>
            <div class="login-error" id="loginError">
                ‚ùå √ârv√©nytelen hozz√°f√©r√©si k√≥d. K√©rlek, ellen≈ërizd √©s pr√≥b√°ld √∫jra.
            </div>
        </div>
    </div>

    <!-- App Container (Original IBAR) -->
    <div class="app-container" id="appContainer">
        <!-- ORIGINAL IBAR CONTENT STARTS HERE -->
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5rem; }
            .btn-grid { grid-template-columns: 1fr; }
            .steps-grid { grid-template-columns: repeat(auto-fit, minmax(35px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header">
            <h1>üéØ Ing√°s Blokkold√≥ Asszisztens</h1>
            <p>F√≥kusz ‚Äì Felt√°r√°s ‚Äì Old√°s ‚Äì Integr√°ci√≥</p>
        </div>

        <div class="card">
            <div class="progress-info">
                <span id="stepInfo">0/32 l√©p√©s</span>
                <span id="percentInfo">0%</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="steps-grid" id="stepsGrid"></div>
        </div>

        <div class="card content-card" id="contentCard"></div>

        <div class="card" id="navigationCard" style="display: none;">
            <div class="btn-grid">
                <button class="btn btn-secondary" onclick="prevStep()">‚Üê Vissza</button>
                <button class="btn btn-purple" onclick="nextStep()">Tov√°bb ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="modal" id="diagramModal">
        <div class="modal-content">
            <h3 id="diagramTitle">Diagram</h3>
            <div class="question-box" id="diagramQuestion"></div>
            <div id="diagramContent"></div>
        </div>
    </div>

    <script>
let currentStep = 0;
let completedSteps = [];
let selectedOptions = [];
let sessionData = {
    answers: {},
    measurements: { initial: null, final: null },
    temValues: { Testi: 0, Erzelmi: 0, Mentalis: 0 },
    releasingTexts: '',
    integratingTexts: '',
    timestamp: null,
    clientName: ''
};

const steps = [
    { id: 0, name: 'R√°hangol√≥d√°s', icon: 'üéØ' },
    { id: 1, name: 'Enged√©lyez√©s', icon: '‚úã', diagram: 'igenNem', question: 'Enged√©lyezett-e most a blokkold√≥ munka?' },
    { id: 2, name: 'Kezdeti m√©r√©s', icon: 'üìä', diagram: 'szazalek', question: 'Mennyire er≈ës ez a blokk jelenleg? (0-100%)' },
    { id: 3, name: '√âletter√ºlet', icon: 'üåç', diagram: 'eletterulet', question: 'Melyik √©letter√ºleten jelentkezik ez a blokk?', multiple: true },
    { id: 4, name: '√ârzelmi Gy√∂k√©r', icon: 'üå±', diagram: 'erzelmGyoker', question: 'Mi az √©rzelmi gy√∂kere ennek a blokknak?', multiple: true },
    { id: 5, name: 'Negat√≠v √ârzelem', icon: 'üí≠', diagram: 'erzelem', question: 'Mely negat√≠v √©rzelem domin√°l?', multiple: true },
    { id: 6, name: 'Trauma', icon: 'üîç', diagram: 'trauma', question: 'Van-e traumatikus esem√©ny a h√°tt√©rben?', multiple: true },
    { id: 7, name: 'Lelki S√©r√ºl√©s', icon: 'üíî', diagram: 'lelkiSerules', question: 'Milyen lelki s√©r√ºl√©s h√∫z√≥dik meg m√∂g√∂tte?', multiple: true },
    { id: 8, name: 'Kapcsolati Gy√∂k√©r', icon: 'üë•', diagram: 'kapcsolat', question: 'Melyik kapcsolathoz k√∂thet≈ë ez a blokk?', multiple: true },
    { id: 9, name: 'Blokk Eredete', icon: '‚è≥', diagram: 'eredet', question: 'Mikor keletkezett ez a blokk?', multiple: true },
    { id: 10, name: 'Hiedelmek', icon: 'üß†', diagram: 'hiedelem', question: 'Milyen korl√°toz√≥ hiedelem √°ll a h√°tt√©rben?', multiple: true },
    { id: 11, name: 'Testi √ârintetts√©g', icon: 'ü´Ä', diagram: 'test', question: 'A test mely r√©sze √©rintett?', multiple: true },
    { id: 12, name: 'Csakra', icon: 'üåà', diagram: 'csakra', question: 'Melyik csakra √©rintett?', multiple: true },
    { id: 13, name: 'Blokk Jellege', icon: 'üî∑', diagram: 'blokkJelleg', question: 'Milyen jelleg≈± ez a blokk?', multiple: true },
    { id: 14, name: 'TEM - Testi', icon: 'ü´Ä', diagram: 'szazalek', question: 'Testi szint m√©r√©se (0-100%)' },
    { id: 15, name: 'TEM - √ârzelmi', icon: 'üí≠', diagram: 'szazalek', question: '√ârzelmi szint m√©r√©se (0-100%)' },
    { id: 16, name: 'TEM - Ment√°lis', icon: 'üß†', diagram: 'szazalek', question: 'Ment√°lis szint m√©r√©se (0-100%)' },
    { id: 17, name: 'TEM M√©r√©s', icon: 'üî∫' },
    { id: 18, name: 'V√©dekez√©s', icon: 'üõ°Ô∏è', diagram: 'vedekezes', question: 'Milyen v√©dekez√©si mechanizmus m≈±k√∂dik?', multiple: true },
    { id: 19, name: '√âletszerep', icon: 'üé≠', diagram: 'szerepek', question: 'Melyik √©letszerepben jelentkezik ez a blokk?', multiple: true },
    { id: 20, name: 'Szabot√°zs', icon: 'üö´', diagram: 'szabotazs', question: 'Milyen √∂nszabot√°zs minta jelenik meg?', multiple: true },
    { id: 21, name: 'M√°sodl. Haszon', icon: 'üîê', diagram: 'haszon', question: 'Mi a m√°sodlagos haszna a blokknak?', multiple: true },
    { id: 22, name: 'Fogadalmak', icon: 'üïäÔ∏è', diagram: 'fogadalom', question: 'Van-e fogadalom vagy esk√º a h√°tt√©rben?', multiple: true },
    { id: 23, name: 'Mikroszk√≥p', icon: 'üî¨', diagram: 'mikroszkop', question: 'Van-e m√©lyebb r√©teg, amit meg kell vizsg√°lni?', multiple: true },
    { id: 24, name: 'K√©sz√ºlts√©g', icon: '‚ö°', diagram: 'igenNem', question: 'K√©szen √°ll a kliens az old√°sra?' },
    { id: 25, name: 'Old√°s', icon: '‚ú®' },
    { id: 26, name: 'Pozit√≠v √ârzelem', icon: 'üòä', diagram: 'pozitivErzelem', question: 'Milyen pozit√≠v √©rzelmet szeretne √©rezni helyette?', multiple: true },
    { id: 27, name: '√öj Hit', icon: 'üí´', diagram: 'ujHit', question: 'Milyen √∫j hitet szeretne mag√°√©v√° tenni?', multiple: true },
    { id: 28, name: 'Sz√≠nek', icon: 'üé®', diagram: 'szinek', question: 'Mely sz√≠n t√°mogatja a gy√≥gyul√°st?', multiple: true },
    { id: 29, name: 'Krist√°lyok', icon: 'üíé', diagram: 'kristaly', question: 'Mely krist√°ly seg√≠t az integr√°ci√≥ban?', multiple: true },
    { id: 30, name: 'Z√°r√≥ m√©r√©s', icon: 'üìà', diagram: 'szazalek', question: 'Mennyire er≈ës a blokk most? (0-100%)' },
    { id: 31, name: 'Old√≥ Sz√∂vegek', icon: 'üìñ' },
    { id: 32, name: 'Lez√°r√°s', icon: 'üôè' }
];

const diagrams = {
    igenNem: { 
        title: 'Igen - Nem - Nem most', 
        options: ['IGEN', 'NEM', 'NEM MOST'],
        colors: ['#bbf7d0', '#fecaca', '#fde68a']
    },
    szazalek: { 
        title: 'Sz√°zal√©kos m√©r√©s', 
        options: ['0%','10%','20%','30%','40%','50%','60%','70%','80%','90%','100%'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe']
    },
    eletterulet: { 
        title: '√âletter√ºletek', 
        options: ['Munka/Karrier', 'P√©nz√ºgyek', 'Szerelem/P√°rkapcsolat', 'Csal√°d', 'Eg√©szs√©g', 'Bar√°ts√°gok', 'Spiritualit√°s', 'Otthon/Lakhat√°s', 'Szabadid≈ë/Hobbik', 'Kreativit√°s/Alkot√°s', '√ñn√©rt√©kel√©s/√ñnbizalom', 'Szexualit√°s/Intimit√°s', 'Tanul√°s/Fejl≈ëd√©s', 'Kommunik√°ci√≥', 'C√©ltudatoss√°g/J√∂v≈ëk√©p'],
        colors: ['#fecaca','#fed7aa','#fde68a','#d9f99d','#bbf7d0','#99f6e4','#bfdbfe','#c7d2fe','#ddd6fe','#e9d5ff','#fbcfe8','#fca5a5','#a7f3d0','#fef3c7','#c7d2fe']
    },
    erzelmGyoker: {
        title: '√ârzelmi Gy√∂k√©r',
        options: ['F√©lelem/Szorong√°s', 'Harag/D√ºh', 'Szomor√∫s√°g/Gy√°sz', '√ñr√∂m (elfojtott)', 'Szeretet (hi√°nya)', 'Bizalom (hi√°nya)', 'B≈±ntudat', 'Sz√©gyen', 'Megvet√©s', 'Undor', 'Meglepet√©s (trauma)', 'V√°gy/Hi√°ny', '√ârzelmi zsibbad√°s', 'F√°jdalom', 'Rejtett v√°gy', 'Tehetetlens√©g', 'Elfojtott d√ºh', 'Mag√°ny'],
        colors: ['#fca5a5', '#fecaca', '#bfdbfe', '#fde68a', '#fbcfe8', '#d1d5db', '#fed7aa', '#fcd34d', '#ddd6fe', '#99f6e4', '#fef3c7', '#f9a8d4', '#e5e7eb', '#fca5a5', '#f5d0fe', '#fecdd3', '#fed7aa', '#c7d2fe']
    },
    erzelem: { 
        title: 'Negat√≠v √ârzelmek', 
        options: ['Harag/D√ºh', 'Szomor√∫s√°g/B√°nat', 'F√©lelem/Aggodalom', 'B≈±ntudat/Sz√©gyen', 'Frusztr√°ci√≥', 'Irigys√©g', 'Elhagyatotts√°g', 'Rem√©nytelens√©g', 'K√©ts√©gbees√©s', 'Kishit≈±s√©g', 'Befel√© ford√≠tott d√ºh', 'Megkesered√©s'],
        colors: ['#fecaca','#fca5a5','#fcd5d5','#fed7aa','#fecaca','#fca5a5','#fecdd3','#fca5a5','#fed7aa','#fcd5d5','#fecaca','#fca5a5']
    },
    trauma: {
        title: 'Trauma M√©ly√≠t√©s',
        options: ['Gyerekkori trauma', 'B√°ntalmaz√°s', 'Elhanyagol√°s', 'Szexu√°lis trauma', '√ârzelmi manipul√°ci√≥', 'Csal√°di konfliktus', 'V√°l√°s', 'Hal√°leset', 'Vesztes√©g', 'Baleset', 'Betegs√©g', 'Iskolai b√°ntalmaz√°s', 'El√°rul√°s', 'Ism√©tl≈ëd≈ë kudarc', '√ñr√∂kl√∂tt trauma', 'Orvosi beavatkoz√°s', 'Term√©szeti katasztr√≥fa', 'H√°bor√∫s trauma', 'Sz√ºl√©si trauma'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fecaca','#fca5a5','#fcd5d5','#fed7aa','#fecaca','#fca5a5','#fcd5d5','#fecdd3','#fed7aa','#fde68a','#fecaca','#fca5a5']
    },
    lelkiSerules: {
        title: 'Lelki S√©r√ºl√©sek',
        options: ['Elutas√≠t√°s', 'Elhagy√°s', 'Megal√°z√°s', '√Årul√°s', 'Igazs√°gtalans√°g', 'L√°thatatlans√°g', 'Meg nem hallgat√°s', '√ârzelmi elhanyagol√°s', 'Fizikai elhanyagol√°s', 'T√∫lv√©d√©s', 'Hat√°rok √°tl√©p√©se', 'Gyermekk√©nt kezel√©s', 'Sz√ºl≈ëi szerep r√°k√©nyszer√≠t√©se', 'B≈±nbakk√©pz√©s', 'Kirekeszt√©s', '√ârzelmi zsarol√°s', 'Val√≥s√°g tagad√°sa', '√Ålland√≥ kritika', '√ñsszehasonl√≠t√°s', 'Felt√©teles szeretet', 'Meg nem √©rt√©s', 'T√∫lterhel√©s', 'Manipul√°ci√≥'],
        colors: ['#fca5a5', '#fcd34d', '#fdba74', '#d8b4fe', '#bfdbfe', '#a5f3fc', '#99f6e4', '#bbf7d0', '#fde68a', '#fecaca', '#ddd6fe', '#e9d5ff', '#fbcfe8', '#fecdd3', '#fed7aa', '#fef3c7', '#ccfbf1', '#c7d2fe', '#ddd6fe', '#fbcfe8', '#a7f3d0', '#fcd5d5', '#e9d5ff']
    },
    kapcsolat: {
        title: 'Kapcsolati Gy√∂k√©r',
        options: ['√ân magam', 'Anya', 'Apa', 'Testv√©r', 'Gyerek', 'Partner', 'H√°zast√°rs', 'Volt partner', 'Bar√°t', 'Koll√©ga', 'F≈ën√∂k', 'Tan√°r', 'Mentor', 'Nagysz√ºl≈ë', 'Rokon', 'Isten/Magasabb √ân', 'El≈ëz≈ë gener√°ci√≥/≈ês√∂k'],
        colors: ['#e9d5ff','#fbcfe8','#bfdbfe','#bbf7d0','#fde68a','#fecaca','#fca5a5','#fcd5d5','#a7f3d0','#c7d2fe','#e9d5ff','#ddd6fe','#d8b4fe','#fed7aa','#fcd34d','#f5d0fe','#c7d2fe']
    },
    eredet: {
        title: 'Blokk Eredete',
        options: ['0-3 √©v', '3-7 √©v', '7-14 √©v', '14-21 √©v', '21-35 √©v', '35-50 √©v', '50+ √©v', 'M√©hen bel√ºl', 'Sz√ºlet√©s', 'Korai gyerek', 'Iskol√°s kor', 'Pubert√°s', 'Fiatal feln≈ëtt', 'M√∫lt √©let', 'Gener√°ci√≥s'],
        colors: ['#fecaca','#fed7aa','#fde68a','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#fca5a5','#fcd5d5','#fecaca','#fed7aa','#fde68a','#d9f99d','#ddd6fe','#e9d5ff']
    },
    hiedelem: { 
        title: 'Korl√°toz√≥ Hiedelmek', 
        options: ['Nem vagyok el√©g j√≥', 'Nem √©rdemlem meg', 'Nem vagyok szerethet≈ë', 'Gyenge vagyok', 'Mindig kudarcot vallok', 'Vesz√©lyes a siker', 'Nem lehetek boldog', 'Nem vagyok tehets√©ges', 'Sosem v√°ltozhatok', 'Nem √©rdemlem meg a sikert', 'Vesz√©lyes kifejezni magam', 'Mindig beteg vagyok', 'Nem b√≠zhatok senkiben', 'A p√©nz rossz'],
        colors: ['#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb']
    },
    test: { 
        title: 'Testt√°j√©kok', 
        options: ['Fej/Agy', 'Torok/Nyak', 'Sz√≠v/Mellkas', 'Gyomor/Has', 'M√°j/Epeh√≥lyag', 'Vese', 'H√°t/Gerinc', 'Der√©k/√Ågy√©k', 'Cs√≠p≈ë/Medence', 'V√©gtagok'],
        colors: ['#e9d5ff','#ddd6fe','#d8b4fe','#e9d5ff','#f3e8ff','#d8b4fe','#ddd6fe','#e9d5ff','#e0d5f5','#d4c5f9']
    },
    csakra: {
        title: 'Csakr√°k',
        options: ['Gy√∂k√©r csakra', 'Szakr√°lis csakra', 'Napfonat csakra', 'Sz√≠v csakra', 'Torok csakra', '3. szem', 'Korona csakra'],
        colors: ['#fecaca','#fed7aa','#fde68a','#bbf7d0','#bfdbfe','#ddd6fe','#e9d5ff']
    },
    blokkJelleg: {
        title: 'Blokk Jellege',
        options: ['√ârzelmi blokk', 'Ment√°lis blokk', 'Fizikai blokk', 'Energetikai blokk', 'Spiritu√°lis blokk', 'Karmikus blokk', 'Lelki blokk', 'Csal√°di blokk', '≈êsi/Ancestr√°lis blokk', 'T√°rsadalmi/Kollekt√≠v blokk', 'Kapcsolati blokk'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe']
    },
    vedekezes: {
        title: 'V√©dekez√©si Mechanizmus',
        options: ['Tagad√°s', 'Elfojt√°s', 'Kivet√≠t√©s', '√âsszer≈±s√≠t√©s', 'Kompenz√°ci√≥', 'Elker√ºl√©s', 'Agresszi√≥', 'T√∂k√©letess√©gre t√∂rekv√©s', 'Kontroll', 'F√ºgg≈ës√©g', 'Disszoci√°ci√≥/Lev√°l√°s', 'Humor', 'T√∫lgondol√°s', '√Åbr√°ndoz√°s/Menek√ºl√©s', 'Burkolt agresszi√≥', '√ârzelmi t√°vols√°gtart√°s'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fef9d5','#d9f99d','#bbf7d0','#d9f99d','#a7f3d0','#99f6e4','#fcd5d5','#e5e7eb']
    },
    szerepek: {
        title: '√âletszerepek',
        options: ['Sz√ºl≈ë szerepben', 'Partner szerepben', 'Munkav√°llal√≥', 'Vezet≈ë szerepben', 'Gyerek szerepben', 'Bar√°t szerepben', 'Koll√©ga szerepben', 'Egyed√ºl/Mag√°n√©let', 'K√∂z√∂ss√©gben', 'Alkot√≥/Kreat√≠v', 'Gyermekk√©nt a sz√ºleim el≈ëtt', 'Spiritu√°lis/Tan√≠t√≥ szerepben', 'Seg√≠t≈ë/Gy√≥gy√≠t√≥ szerepben'],
        colors: ['#fbcfe8','#fecaca','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#99f6e4','#bfdbfe','#c7d2fe','#e9d5ff','#f5d0fe','#ddd6fe','#a7f3d0']
    },
    szabotazs: {
        title: 'Szabot√°zs Mint√°k',
        options: ['Halogat√°s', 'T√∂k√©letes√≠t√©s', 'F√©lbehagy√°s', '√ñnkritika', 'T√∫lv√°llal√°s', 'Kontroll ig√©nye', '√ñsszehasonl√≠t√°s', 'K√ºzdelem', 'Gyors felad√°s', 'Menek√ºl√©s', 'Nincs szabot√°zs'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fef9d5','#d9f99d','#bbf7d0']
    },
    haszon: {
        title: 'M√°sodlagos Haszon',
        options: ['Biztons√°got ad', 'Identit√°st ad', 'Figyelmet kapok', 'Szeretetet kapok', 'Nem kell v√°ltoznom', 'Nem kell felel≈ëss√©g', 'Elker√ºl√∂m a kudarcot', 'V√©delmez m√°sok el≈ël', 'Igazol engem', 'Nem kell teljes√≠tenem', 'Sajn√°lnak/Egy√ºtt√©rz√©st kapok'],
        colors: ['#fde68a','#fed7aa','#fecaca','#fbcfe8','#f5d0fe','#e9d5ff','#ddd6fe','#d8b4fe','#c7d2fe','#bfdbfe','#fef3c7']
    },
    fogadalom: {
        title: 'Fogadalmak',
        options: ['Soha nem leszek mint ≈ë', 'Mindig v√©deni fogom magam', 'Soha nem engedem meg', 'Mindig er≈ës leszek', 'Soha nem b√≠zom', 'Mindig egyed√ºl csin√°lom', 'Soha nem fogok s√≠rni', 'Mindig kontroll alatt', '√ñr√∂k h≈±s√©g', 'Csal√°di fogadalom', 'Vall√°si fogadalom', 'L√©lek szerz≈ëd√©s', 'Soha nem leszek boldog', 'Mindig √°ldozat leszek', 'Nem √©rdemlem meg a j√≥t', 'Nincs fogadalom'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fbcfe8','#ddd6fe','#d8b4fe','#a5f3fc','#fcd5d5','#fca5a5','#fed7aa','#bbf7d0']
    },
    mikroszkop: {
        title: 'Mikroszk√≥p - Tov√°bbi r√©szletek',
        options: ['Csal√°di minta', 'T√°rsadalmi kondicion√°l√°s', 'Kultur√°lis elv√°r√°s', 'Nemi szerep', 'Vall√°si tan√≠t√°s', 'Iskolai tapasztalat', 'M√©dia hat√°s', 'Kort√°rs nyom√°s', 'T√∂rt√©nelmi trauma', 'Kollekt√≠v tudattalan', 'Ancestr√°lis √°t√∂r√∂k√≠t√©s', 'Lelki szerz≈ëd√©s', 'Energetikai kapcsolat', 'Karmikus lenyomat', 'T√°rsl√©lek befoly√°s', 'Entit√°s attachment', '√Åtkok/√Åtkoz√°sok', 'Nincs t√∂bb r√©szlet'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe','#ddd6fe','#e9d5ff','#f5d0fe','#fecdd3','#fbcfe8','#fca5a5','#fed7aa','#bbf7d0']
    },
    pozitivErzelem: {
        title: 'Pozit√≠v √ârzelmek',
        options: ['√ñr√∂m', 'B√©ke', 'Szeretet', 'H√°la', 'Szabads√°g', 'Bizalom', 'B√°tors√°g', 'Rem√©ny', 'Lelkesed√©s', 'Megel√©gedetts√©g', 'Biztons√°g', 'K√∂nnyeds√©g'],
        colors: ['#fef3c7','#fef9d5','#fef3c7','#fde68a','#fed7aa','#fcd34d','#fef3c7','#fef9d5','#fef9c3','#d9f99d','#bbf7d0','#d9f99d']
    },
    ujHit: {
        title: '√öj Hiedelmek',
        options: ['El√©g j√≥ vagyok', 'Meg√©rdemlem a j√≥t', 'Szerethet≈ë vagyok', 'Er≈ës vagyok', 'Sikereket √©rek el', 'Biztons√°gos a siker', 'Boldog lehetek', 'Tehets√©ges vagyok', 'V√°ltozhatok √©s fejl≈ëdhetek', 'B√≠zom magamban', 'Elfogadom magam', 'Megbocs√°tok magamnak'],
        colors: ['#bbf7d0','#a7f3d0','#99f6e4','#99f6e4','#a5f3fc','#bfdbfe','#a5f3fc','#bfdbfe','#c7d2fe','#bfdbfe','#c7d2fe','#ddd6fe']
    },
    szinek: {
        title: 'Gy√≥gy√≠t√≥ Sz√≠nek',
        options: ['Feh√©r (tisztas√°g)', 'Arany (b√∂lcsess√©g)', 'Ez√ºst (intu√≠ci√≥)', 'Lila (spiritualit√°s)', 'K√©k (kommunik√°ci√≥)', 'Z√∂ld (gy√≥gyul√°s)', 'R√≥zsasz√≠n (szeretet)', 'Narancss√°rga (kreativit√°s)', 'S√°rga (√∂r√∂m)', 'T√ºrkiz (v√©delem)', 'Fekete (v√©delem/f√∂ldel√©s)'],
        colors: ['#fafafa','#fef3c7','#e5e7eb','#e9d5ff','#bfdbfe','#bbf7d0','#fbcfe8','#fed7aa','#fef3c7','#99f6e4','#374151']
    },
    kristaly: {
        title: 'Gy√≥gy√≠t√≥ Krist√°lyok',
        options: ['Hegyikrist√°ly', '√ìnix', 'Szodalit', 'Tigrisszem', 'R√≥zsakvarc', 'Hematit', 'Ametiszt', 'Aventurin', 'Ach√°t', 'Citrin', 'Karneol', 'Holdk≈ë', 'J√°spis', 'Howlit', 'Cseresznyekvarc', 'Obszidi√°n'],
        colors: ['#e5e7eb','#2d3748','#93c5fd','#fcd34d','#fbcfe8','#6b7280','#ddd6fe','#86efac','#d1d5db','#fef3c7','#fed7aa','#f3f4f6','#fca5a5','#fecdd3','#fbb6ce','#4a5568']
    }
};

function init() {
    renderStepsGrid();
    loadStep(0);
}

function renderStepsGrid() {
    const grid = document.getElementById('stepsGrid');
    grid.innerHTML = steps.map((step, i) => {
        let className = 'step-icon pending';
        if (i === currentStep) className = 'step-icon active';
        else if (completedSteps.includes(i)) className = 'step-icon completed';
        return '<div class="' + className + '" onclick="jumpToStep(' + i + ')" title="' + step.name + '">' + step.icon + '</div>';
    }).join('');
    
    const percent = Math.round((currentStep / steps.length) * 100);
    document.getElementById('stepInfo').textContent = currentStep + '/' + steps.length + ' l√©p√©s';
    document.getElementById('percentInfo').textContent = percent + '%';
    document.getElementById('progressBar').style.width = percent + '%';
}

function loadStep(stepIndex) {
    currentStep = stepIndex;
    selectedOptions = [];
    renderStepsGrid();
    
    const step = steps[stepIndex];
    const card = document.getElementById('contentCard');
    
    let html = '<h2>' + step.icon + ' ' + step.name + '</h2>';
    
    switch(stepIndex) {
        case 0:
            html += '<div class="info-box purple"><p><strong>√údv√∂z√∂llek a blokkold√≥ folyamatban!</strong></p><p style="margin-top: 12px;">K√©sz√ºljetek fel a munk√°ra: keressetek egy csendes helyet, vegyetek m√©ly l√©legzeteket, √©s nyiss√°tok meg magatokat a v√°ltoz√°sra.</p><p style="margin-top: 12px;">A kezel≈ë v√©gigk√≠s√©ri a klienst minden l√©p√©sen, megbesz√©lik a kapott √©rt√©keket √©s k√∂z√∂sen dolgoznak a blokk felold√°s√°n.</p></div><div class="info-box blue" style="margin-top: 16px;"><label style="display: block; margin-bottom: 8px; font-weight: 600;">Kliens neve (opcion√°lis):</label><input type="text" id="clientName" placeholder="N√©v megad√°sa..." value="' + sessionData.clientName + '"></div><button class="btn btn-purple" onclick="saveClientName(); nextStep();">Kezdj√ºk! ‚Üí</button>';
            break;
            
        case 17:
            html += '<div class="info-box purple"><p><strong>TEM M√©r√©s - H√°rom dimenzi√≥ vizsg√°lata</strong></p><p style="margin-top: 12px;">M√©rd meg az ing√°val, hogy melyik szinten milyen er≈ës a blokk:</p></div><div class="slider-container"><div class="slider-group"><label>ü´Ä Testi szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Testi + '" class="slider" id="testiSlider" oninput="updateSliderValue(\'Testi\')"><span class="slider-value" id="testiValue">' + sessionData.temValues.Testi + '%</span></div></div><div class="slider-group"><label>üí≠ √ârzelmi szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Erzelmi + '" class="slider" id="erzelmiSlider" oninput="updateSliderValue(\'Erzelmi\')"><span class="slider-value" id="erzelmiValue">' + sessionData.temValues.Erzelmi + '%</span></div></div><div class="slider-group"><label>üß† Ment√°lis szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Mentalis + '" class="slider" id="mentalisSlider" oninput="updateSliderValue(\'Mentalis\')"><span class="slider-value" id="mentalisValue">' + sessionData.temValues.Mentalis + '%</span></div></div></div><div class="btn-grid"><button class="btn btn-secondary" onclick="prevStep()">‚Üê Vissza</button><button class="btn btn-purple" onclick="saveTEM()">Ment√©s √©s tov√°bb ‚Üí</button></div>';
            break;
            
        case 25:
            html += '<div class="info-box yellow"><p><strong>Most k√∂vetkezik az old√°s pillanata!</strong></p><p style="margin-top: 12px;">A kezel≈ë k√©ri az ing√°t, hogy oldja fel a blokkot. Figyelj√©tek meg egy√ºtt a mozg√°st, √©s v√°rj√°tok meg, am√≠g meg√°ll.</p></div><div class="info-box green" style="margin-top: 16px;"><p style="text-align: center; font-size: 1.1rem;">‚ú® <em>"Elengedem ezt a blokkot. Szabadd√° v√°lok. K√∂sz√∂n√∂m a tanuls√°got, ami m√∂g√∂tte rejlett."</em></p></div><button class="btn btn-purple" onclick="nextStep()">Old√°s megt√∂rt√©nt ‚Üí</button>';
            break;
            
        case 31:
            generateReleasingText();
            generateIntegratingText();
            html += '<div class="info-box purple"><p><strong>Old√≥ √©s integr√°l√≥ affirm√°ci√≥k</strong></p><p style="margin-top: 8px;">A kezel≈ë felolvassa az al√°bbi sz√∂vegeket a kliensnek, majd k√∂z√∂sen √°tbesz√©lik ≈ëket. A sz√∂vegek szerkeszthet≈ëk.</p></div>';
            html += '<h3 style="margin-top: 24px; color: #7e22ce;">üìñ Old√≥ sz√∂veg:</h3>';
            html += '<textarea id="releasingTextArea" style="min-height: 200px;">' + sessionData.releasingTexts + '</textarea>';
            html += '<h3 style="margin-top: 24px; color: #7e22ce;">üí´ Integr√°l√≥ sz√∂veg:</h3>';
            html += '<textarea id="integratingTextArea" style="min-height: 200px;">' + sessionData.integratingTexts + '</textarea>';
            html += '<button class="btn btn-purple" onclick="saveTexts(); nextStep()">Ment√©s √©s folytat√°s ‚Üí</button>';
            break;
            
        case 32:
            html += '<div class="info-box green"><p><strong>üéâ A blokkold√≥ kezel√©s befejez≈ëd√∂tt!</strong></p><p style="margin-top: 8px;">A kezel≈ë most elk√©sz√≠ti a kezel≈ëlapot, amit √°tad a kliensnek √©s megtart mag√°nak dokument√°ci√≥k√©nt.</p></div>';
            html += '<div class="summary-section"><h3>üìä Munkamenet √∂sszefoglal√≥</h3>';
            html += '<p><strong>Kliens:</strong> ' + (sessionData.clientName || 'N/A') + '</p>';
            html += '<p><strong>Kezdeti m√©r√©s:</strong> ' + (sessionData.measurements.initial || 'N/A') + '</p>';
            html += '<p><strong>Z√°r√≥ m√©r√©s:</strong> ' + (sessionData.measurements.final || 'N/A') + '</p>';
            if (sessionData.measurements.initial && sessionData.measurements.final) {
                const improvement = parseInt(sessionData.measurements.initial.replace('%','')) - parseInt(sessionData.measurements.final.replace('%',''));
                html += '<p><strong>V√°ltoz√°s:</strong> ' + (improvement > 0 ? '-' : '+') + Math.abs(improvement) + '% ' + (improvement > 0 ? '‚úÖ' : '‚ö†Ô∏è') + '</p>';
            }
            html += '<p style="margin-top: 16px;"><strong>TEM √©rt√©kek:</strong></p>';
            html += '<p>‚Ä¢ Testi: ' + sessionData.temValues.Testi + '%</p>';
            html += '<p>‚Ä¢ √ârzelmi: ' + sessionData.temValues.Erzelmi + '%</p>';
            html += '<p>‚Ä¢ Ment√°lis: ' + sessionData.temValues.Mentalis + '%</p>';
            
            if (Object.keys(sessionData.answers).length > 0) {
                html += '<p style="margin-top: 16px;"><strong>Kiemelt v√°laszok:</strong></p>';
                for (let stepId in sessionData.answers) {
                    const step = steps[stepId];
                    if (step && sessionData.answers[stepId]) {
                        html += '<p>‚Ä¢ <em>' + step.name + ':</em> ' + sessionData.answers[stepId] + '</p>';
                    }
                }
            }
            html += '</div>';
            html += '<button class="btn btn-download" onclick="saveSessionDOCX()">üíæ Kezel≈ëlap ment√©se (.doc)</button>';
            html += '<button class="btn btn-purple" style="margin-top: 16px;" onclick="confirmFinish()">‚ú® √öj kezel√©s ind√≠t√°sa</button>';
            break;
            
        default:
            if (step.diagram) {
                html += '<div class="question-box">‚ùì ' + step.question + '</div>';
                html += '<div class="info-box blue"><p>Haszn√°ld az ing√°t a v√°lasz megtal√°l√°s√°hoz. ' + (step.multiple ? 'T√∂bb opci√≥ is kiv√°laszthat√≥.' : '') + '</p></div>';
                html += '<button class="btn btn-primary" onclick="openDiagram(\'' + step.diagram + '\', ' + step.multiple + ')">Ing√°s m√©r√©s ‚Üí</button>';
                if (sessionData.answers[stepIndex]) {
                    html += '<div class="answer-display"><div class="answer-label">V√°lasz:</div><div class="answer-value">' + sessionData.answers[stepIndex] + '</div></div>';
                }
            } else {
                html += '<div class="info-box purple"><p>Folytass√°tok a k√∂vetkez≈ë l√©p√©ssel.</p></div><button class="btn btn-purple" onclick="nextStep()">Tov√°bb ‚Üí</button>';
            }
    }
    
    card.innerHTML = html;
    
    const navCard = document.getElementById('navigationCard');
    if (stepIndex > 0 && stepIndex < steps.length - 1 && stepIndex !== 17 && stepIndex !== 31) {
        navCard.style.display = 'block';
    } else {
        navCard.style.display = 'none';
    }
}

function saveClientName() {
    const nameInput = document.getElementById('clientName');
    if (nameInput) {
        sessionData.clientName = nameInput.value.trim();
    }
}

function updateSliderValue(type) {
    const slider = document.getElementById(type.toLowerCase() + 'Slider');
    const valueDisplay = document.getElementById(type.toLowerCase() + 'Value');
    valueDisplay.textContent = slider.value + '%';
}

function saveTEM() {
    sessionData.temValues.Testi = parseInt(document.getElementById('testiSlider').value);
    sessionData.temValues.Erzelmi = parseInt(document.getElementById('erzelmiSlider').value);
    sessionData.temValues.Mentalis = parseInt(document.getElementById('mentalisSlider').value);
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    nextStep();
}

function saveTexts() {
    sessionData.releasingTexts = document.getElementById('releasingTextArea').value;
    sessionData.integratingTexts = document.getElementById('integratingTextArea').value;
}

function createCircleDiagram(diag, type) {
    const opts = diag.options;
    const colors = diag.colors;
    const angleStep = 360 / opts.length;
    const centerX = 300, centerY = 300, radius = 250;
    
    let paths = '';
    
    opts.forEach(function(opt, i) {
        const angle1 = (i * angleStep - 90) * Math.PI / 180;
        const angle2 = ((i + 1) * angleStep - 90) * Math.PI / 180;
        const x1 = centerX + radius * Math.cos(angle1);
        const y1 = centerY + radius * Math.sin(angle1);
        const x2 = centerX + radius * Math.cos(angle2);
        const y2 = centerY + radius * Math.sin(angle2);
        
        const midAngle = (angle1 + angle2) / 2;
        const textRadius = radius * 0.65;
        const textX = centerX + textRadius * Math.cos(midAngle);
        const textY = centerY + textRadius * Math.sin(midAngle);
        
        let rotationAngle = (midAngle * 180 / Math.PI);
        
        const escaped = opt.replace(/'/g, '&#39;');
        const textLen = opt.length;
        const fontSize = textLen > 25 ? 10 : (textLen > 20 ? 11 : (textLen > 15 ? 12 : (textLen > 10 ? 13 : 14)));
        
        paths += '<path class="diagram-sector" d="M' + centerX + ',' + centerY + ' L' + x1 + ',' + y1 + ' A' + radius + ',' + radius + ' 0 0,1 ' + x2 + ',' + y2 + ' Z" fill="' + colors[i] + '" onclick="toggleOption(\'' + escaped + '\', ' + steps[currentStep].multiple + ')" style="cursor: pointer; transition: all 0.2s; stroke: #fff; stroke-width: 2;" onmouseover="this.style.opacity=0.8; this.style.strokeWidth=3;" onmouseout="this.style.opacity=1; this.style.strokeWidth=2;" />';
        paths += '<text x="' + textX + '" y="' + textY + '" font-size="' + fontSize + '" text-anchor="middle" dominant-baseline="middle" transform="rotate(' + rotationAngle + ' ' + textX + ' ' + textY + ')" style="pointer-events: none; font-weight: bold; fill: #1f2937; text-shadow: 0px 0px 4px rgba(255,255,255,0.9);">' + opt + '</text>';
    });
    
    return '<svg viewBox="0 0 600 600" style="width: 100%; max-width: 600px; height: auto; margin: 20px auto; display: block;">' + paths + '</svg>';
}

function openDiagram(type, isMultiple) {
    const diag = diagrams[type];
    if (!diag) return;
    
    const step = steps[currentStep];
    document.getElementById('diagramTitle').textContent = diag.title;
    document.getElementById('diagramQuestion').textContent = step.question || '';
    
    // Restore previously selected options
    if (sessionData.answers[currentStep]) {
        selectedOptions = sessionData.answers[currentStep].split(', ');
    } else {
        selectedOptions = [];
    }
    
    let html = createCircleDiagram(diag, type);
    html += '<div class="diagram-grid" style="margin-top: 24px;">';
    diag.options.forEach(function(opt) {
        const isSelected = selectedOptions.includes(opt);
        const selectedClass = isSelected ? ' selected' : '';
        html += '<button class="diagram-button' + selectedClass + '" onclick="toggleOption(\'' + opt.replace(/'/g, "&#39;") + '\', ' + isMultiple + ')">' + opt + '</button>';
    });
    html += '</div>';
    
    if (isMultiple) {
        html += '<button class="btn btn-purple" style="margin-top: 16px;" onclick="saveMultipleOptions()">Kiv√°laszt√°s ment√©se</button>';
        html += '<button class="btn btn-skip" style="margin-top: 8px;" onclick="skipDiagram()">Kihagy√°s</button>';
    } else {
        html += '<button class="btn btn-skip" style="margin-top: 16px;" onclick="skipDiagram()">Kihagy√°s</button>';
    }
    html += '<button class="btn btn-secondary" style="margin-top: 8px;" onclick="closeDiagram()">Bez√°r√°s</button>';
    
    document.getElementById('diagramContent').innerHTML = html;
    document.getElementById('diagramModal').classList.add('active');
}

function toggleOption(option, isMultiple) {
    const index = selectedOptions.indexOf(option);
    
    if (isMultiple) {
        // Multiple selection mode
        if (index > -1) {
            selectedOptions.splice(index, 1);
        } else {
            selectedOptions.push(option);
        }
        // Update button states
        const buttons = document.querySelectorAll('.diagram-button');
        buttons.forEach(btn => {
            if (btn.textContent === option) {
                btn.classList.toggle('selected');
            }
        });
    } else {
        // Single selection mode - save immediately
        if (currentStep === 2) {
            sessionData.measurements.initial = option;
        } else if (currentStep === 14) {
            // TEM - Testi
            sessionData.temValues.Testi = parseInt(option);
        } else if (currentStep === 15) {
            // TEM - √ârzelmi
            sessionData.temValues.Erzelmi = parseInt(option);
        } else if (currentStep === 16) {
            // TEM - Ment√°lis
            sessionData.temValues.Mentalis = parseInt(option);
        } else if (currentStep === 30) {
            sessionData.measurements.final = option;
        } else {
            sessionData.answers[currentStep] = option;
        }
        
        closeDiagram();
        
        if (!completedSteps.includes(currentStep)) {
            completedSteps.push(currentStep);
        }
        
        loadStep(currentStep);
    }
}

function saveMultipleOptions() {
    if (selectedOptions.length > 0) {
        sessionData.answers[currentStep] = selectedOptions.join(', ');
    }
    
    closeDiagram();
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    
    loadStep(currentStep);
}

function skipDiagram() {
    sessionData.answers[currentStep] = 'Kihagyva';
    
    closeDiagram();
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    
    loadStep(currentStep);
}

function closeDiagram() {
    document.getElementById('diagramModal').classList.remove('active');
}

function generateReleasingText() {
    let parts = [];
    
    parts.push("Elengedem ezt a blokkot, amely eddig visszatartott az √©letemben.");
    
    if (sessionData.answers[3]) {
        parts.push("Felszabadulok a(z) " + sessionData.answers[3].toLowerCase() + " ter√ºlet√©n m≈±k√∂d≈ë korl√°taimt√≥l.");
    }
    
    if (sessionData.answers[4] || sessionData.answers[5]) {
        const emotion = sessionData.answers[5] || sessionData.answers[4];
        parts.push("Elengedem a " + emotion.toLowerCase() + " √©rz√©s√©t, amely √°thatotta a l√©temet.");
    }
    
    if (sessionData.answers[6]) {
        parts.push("Gy√≥gy√≠tom a " + sessionData.answers[6].toLowerCase() + " nyomait.");
    }
    
    if (sessionData.answers[7]) {
        parts.push("Gy√≥gy√≠tom a " + sessionData.answers[7].toLowerCase() + " okozta sebeket.");
    }
    
    if (sessionData.answers[8]) {
        parts.push("B√©k√©ben elengedem azt, ami a " + sessionData.answers[8].toLowerCase() + " kapcsolat√°b√≥l eredt.");
    }
    
    if (sessionData.answers[10]) {
        parts.push("Nem hiszek tov√°bb abban, hogy \"" + sessionData.answers[10].toLowerCase() + "\".");
    }
    
    if (sessionData.answers[18]) {
        parts.push("Nem sz√ºks√©ges t√∂bb√© a " + sessionData.answers[18].toLowerCase() + ", v√©dtelen vagyok √©s ez rendben van.");
    }
    
    if (sessionData.answers[20] && sessionData.answers[20] !== 'Nincs szabot√°zs') {
        parts.push("Elengedem az √∂nszabot√°zs mint√°t: " + sessionData.answers[20].toLowerCase() + ".");
    }
    
    if (sessionData.answers[21]) {
        parts.push("Felismerem √©s elengedem a m√°sodlagos hasznot: " + sessionData.answers[21].toLowerCase() + ".");
    }
    
    if (sessionData.answers[22] && sessionData.answers[22] !== 'Nincs fogadalom') {
        parts.push("Feloldom a fogadalmat: \"" + sessionData.answers[22].toLowerCase() + "\".");
    }
    
    parts.push("K√∂sz√∂n√∂m a tanuls√°got, amit ez a blokk hozott sz√°momra.");
    parts.push("Most szabadon engedem, √©s nyitott vagyok az √∫j lehet≈ës√©gekre.");
    
    sessionData.releasingTexts = parts.join('\n\n');
}

function generateIntegratingText() {
    let parts = [];
    
    parts.push("Elfogadom az √∫j val√≥s√°gomat, amelyben szabad √©s eg√©sz vagyok.");
    
    if (sessionData.answers[26]) {
        parts.push(sessionData.answers[26] + " t√∂lti el a sz√≠vemet √©s a testemet.");
    }
    
    if (sessionData.answers[27]) {
        parts.push("√öj hitem: " + sessionData.answers[27] + ".");
    }
    
    if (sessionData.answers[3]) {
        parts.push("A(z) " + sessionData.answers[3].toLowerCase() + " ter√ºlet√©n szabadon kibontakozom.");
    }
    
    if (sessionData.answers[8]) {
        parts.push("Eg√©szs√©ges √©s t√°pl√°l√≥ kapcsolatokat √©p√≠tek, szabadon √©s szeretettel.");
    }
    
    if (sessionData.answers[11]) {
        parts.push("A testem " + sessionData.answers[11].toLowerCase() + " ter√ºlete gy√≥gyul √©s er≈ës√∂dik.");
    }
    
    if (sessionData.answers[12]) {
        parts.push("A " + sessionData.answers[12].toLowerCase() + " harmoniz√°l√≥dik √©s √°ramlik bennem az energia.");
    }
    
    if (sessionData.answers[28]) {
        const szin = sessionData.answers[28].split('(')[0].trim();
        parts.push(szin + " f√©ny vesz k√∂r√ºl √©s gy√≥gy√≠t.");
    }
    
    if (sessionData.answers[29]) {
        parts.push(sessionData.answers[29] + " energi√°ja t√°mogat √©s er≈ës√≠t.");
    }
    
    parts.push("H√°l√°s vagyok a v√°ltoz√°s√©rt √©s az √∫j lehet≈ës√©gek√©rt.");
    parts.push("Bizalommal l√©pek el≈ëre az √©letemben, tudva, hogy meg√©rdemlem a j√≥t.");
    
    sessionData.integratingTexts = parts.join('\n\n');
}

function saveSessionDOCX() {
    // Make sure texts are generated
    if (!sessionData.releasingTexts) {
        generateReleasingText();
    }
    if (!sessionData.integratingTexts) {
        generateIntegratingText();
    }
    
    sessionData.timestamp = new Date().toISOString();
    const datum = new Date(sessionData.timestamp).toLocaleString('hu-HU');
    const clientInfo = sessionData.clientName || 'N/A';
    
    // Generate text report
    let report = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
    report += '                    ING√ÅS BLOKKOLD√ì KEZEL≈êLAP\n';
    report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    report += 'Kliens: ' + clientInfo + '\n';
    report += 'D√°tum: ' + datum + '\n\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'M√âR√âSEK\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'Kezdeti m√©r√©s: ' + (sessionData.measurements.initial || 'N/A') + '\n';
    report += 'Z√°r√≥ m√©r√©s: ' + (sessionData.measurements.final || 'N/A') + '\n';
    
    if (sessionData.measurements.initial && sessionData.measurements.final) {
        const initial = parseInt(sessionData.measurements.initial.replace('%',''));
        const final = parseInt(sessionData.measurements.final.replace('%',''));
        const change = initial - final;
        report += 'V√°ltoz√°s: ' + change + '%\n';
    }
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'TEM M√âR√âS (Testi-√ârzelmi-Ment√°lis)\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'Testi szint: ' + sessionData.temValues.Testi + '%\n';
    report += '√ârzelmi szint: ' + sessionData.temValues.Erzelmi + '%\n';
    report += 'Ment√°lis szint: ' + sessionData.temValues.Mentalis + '%\n';
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'FELT√ÅRT TER√úLETEK\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    for (let stepId in sessionData.answers) {
        const step = steps[stepId];
        if (step && sessionData.answers[stepId] && sessionData.answers[stepId] !== 'Kihagyva') {
            report += step.name + ': ' + sessionData.answers[stepId] + '\n';
        }
    }
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'OLD√ì SZ√ñVEG\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += sessionData.releasingTexts + '\n';
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'INTEGR√ÅL√ì SZ√ñVEG\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += sessionData.integratingTexts + '\n';
    
    report += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
    report += '                        KEZEL√âS V√âGE\n';
    report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    report += 'Kezel≈ë al√°√≠r√°sa: _______________________\n\n';
    report += 'Megjegyz√©sek:\n';
    report += '_______________________________________________________________\n';
    report += '_______________________________________________________________\n';
    
    // Create and download file
    try {
        const fileName = sessionData.clientName ? 
            'Kezelolap_' + sessionData.clientName.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.doc' : 
            'Kezelolap_' + new Date().toISOString().slice(0,10) + '.doc';
        
        const blob = new Blob(['\uFEFF' + report], { type: 'application/msword;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = fileName;
        
        document.body.appendChild(a);
        a.click();
        
        setTimeout(function() {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('‚úÖ Kezel≈ëlap sikeresen mentve!\n\n' + fileName);
        }, 100);
    } catch (error) {
        console.error('Save error:', error);
        alert('‚ùå Hiba t√∂rt√©nt a ment√©s sor√°n. Pr√≥b√°ld √∫jra!');
    }
}

function nextStep() {
    if (currentStep < steps.length - 1) {
        if (!completedSteps.includes(currentStep)) {
            completedSteps.push(currentStep);
        }
        loadStep(currentStep + 1);
    }
}

function prevStep() {
    if (currentStep > 0) {
        loadStep(currentStep - 1);
    }
}

function jumpToStep(index) {
    loadStep(index);
}

function confirmFinish() {
    if (confirm('üôè √öj kezel√©st ind√≠tasz? A jelenlegi adatok elvesznek, ha nem mentetted el!')) {
        resetSession();
    }
}

function resetSession() {
    currentStep = 0;
    completedSteps = [];
    selectedOptions = [];
    sessionData = {
        answers: {},
        <div class="card content-card" id="contentCard"></div>

        <div class="card" id="navigationCard" style="display: none;">
            <div class="btn-grid">
                <button class="btn btn-secondary" onclick="prevStep()">‚Üê Vissza</button>
                <button class="btn btn-purple" onclick="nextStep()">Tov√°bb ‚Üí</button>
            </div>
        </div>
    </div>

    <div class="modal" id="diagramModal">
        <div class="modal-content">
            <h3 id="diagramTitle">Diagram</h3>
            <div class="question-box" id="diagramQuestion"></div>
            <div id="diagramContent"></div>
        </div>
    </div>

    <script>
let currentStep = 0;
let completedSteps = [];
let selectedOptions = [];
let sessionData = {
    answers: {},
    measurements: { initial: null, final: null },
    temValues: { Testi: 0, Erzelmi: 0, Mentalis: 0 },
    releasingTexts: '',
    integratingTexts: '',
    timestamp: null,
    clientName: ''
};

const steps = [
    { id: 0, name: 'R√°hangol√≥d√°s', icon: 'üéØ' },
    { id: 1, name: 'Enged√©lyez√©s', icon: '‚úã', diagram: 'igenNem', question: 'Enged√©lyezett-e most a blokkold√≥ munka?' },
    { id: 2, name: 'Kezdeti m√©r√©s', icon: 'üìä', diagram: 'szazalek', question: 'Mennyire er≈ës ez a blokk jelenleg? (0-100%)' },
    { id: 3, name: '√âletter√ºlet', icon: 'üåç', diagram: 'eletterulet', question: 'Melyik √©letter√ºleten jelentkezik ez a blokk?', multiple: true },
    { id: 4, name: '√ârzelmi Gy√∂k√©r', icon: 'üå±', diagram: 'erzelmGyoker', question: 'Mi az √©rzelmi gy√∂kere ennek a blokknak?', multiple: true },
    { id: 5, name: 'Negat√≠v √ârzelem', icon: 'üí≠', diagram: 'erzelem', question: 'Mely negat√≠v √©rzelem domin√°l?', multiple: true },
    { id: 6, name: 'Trauma', icon: 'üîç', diagram: 'trauma', question: 'Van-e traumatikus esem√©ny a h√°tt√©rben?', multiple: true },
    { id: 7, name: 'Lelki S√©r√ºl√©s', icon: 'üíî', diagram: 'lelkiSerules', question: 'Milyen lelki s√©r√ºl√©s h√∫z√≥dik meg m√∂g√∂tte?', multiple: true },
    { id: 8, name: 'Kapcsolati Gy√∂k√©r', icon: 'üë•', diagram: 'kapcsolat', question: 'Melyik kapcsolathoz k√∂thet≈ë ez a blokk?', multiple: true },
    { id: 9, name: 'Blokk Eredete', icon: '‚è≥', diagram: 'eredet', question: 'Mikor keletkezett ez a blokk?', multiple: true },
    { id: 10, name: 'Hiedelmek', icon: 'üß†', diagram: 'hiedelem', question: 'Milyen korl√°toz√≥ hiedelem √°ll a h√°tt√©rben?', multiple: true },
    { id: 11, name: 'Testi √ârintetts√©g', icon: 'ü´Ä', diagram: 'test', question: 'A test mely r√©sze √©rintett?', multiple: true },
    { id: 12, name: 'Csakra', icon: 'üåà', diagram: 'csakra', question: 'Melyik csakra √©rintett?', multiple: true },
    { id: 13, name: 'Blokk Jellege', icon: 'üî∑', diagram: 'blokkJelleg', question: 'Milyen jelleg≈± ez a blokk?', multiple: true },
    { id: 14, name: 'TEM - Testi', icon: 'ü´Ä', diagram: 'szazalek', question: 'Testi szint m√©r√©se (0-100%)' },
    { id: 15, name: 'TEM - √ârzelmi', icon: 'üí≠', diagram: 'szazalek', question: '√ârzelmi szint m√©r√©se (0-100%)' },
    { id: 16, name: 'TEM - Ment√°lis', icon: 'üß†', diagram: 'szazalek', question: 'Ment√°lis szint m√©r√©se (0-100%)' },
    { id: 17, name: 'TEM M√©r√©s', icon: 'üî∫' },
    { id: 18, name: 'V√©dekez√©s', icon: 'üõ°Ô∏è', diagram: 'vedekezes', question: 'Milyen v√©dekez√©si mechanizmus m≈±k√∂dik?', multiple: true },
    { id: 19, name: '√âletszerep', icon: 'üé≠', diagram: 'szerepek', question: 'Melyik √©letszerepben jelentkezik ez a blokk?', multiple: true },
    { id: 20, name: 'Szabot√°zs', icon: 'üö´', diagram: 'szabotazs', question: 'Milyen √∂nszabot√°zs minta jelenik meg?', multiple: true },
    { id: 21, name: 'M√°sodl. Haszon', icon: 'üîê', diagram: 'haszon', question: 'Mi a m√°sodlagos haszna a blokknak?', multiple: true },
    { id: 22, name: 'Fogadalmak', icon: 'üïäÔ∏è', diagram: 'fogadalom', question: 'Van-e fogadalom vagy esk√º a h√°tt√©rben?', multiple: true },
    { id: 23, name: 'Mikroszk√≥p', icon: 'üî¨', diagram: 'mikroszkop', question: 'Van-e m√©lyebb r√©teg, amit meg kell vizsg√°lni?', multiple: true },
    { id: 24, name: 'K√©sz√ºlts√©g', icon: '‚ö°', diagram: 'igenNem', question: 'K√©szen √°ll a kliens az old√°sra?' },
    { id: 25, name: 'Old√°s', icon: '‚ú®' },
    { id: 26, name: 'Pozit√≠v √ârzelem', icon: 'üòä', diagram: 'pozitivErzelem', question: 'Milyen pozit√≠v √©rzelmet szeretne √©rezni helyette?', multiple: true },
    { id: 27, name: '√öj Hit', icon: 'üí´', diagram: 'ujHit', question: 'Milyen √∫j hitet szeretne mag√°√©v√° tenni?', multiple: true },
    { id: 28, name: 'Sz√≠nek', icon: 'üé®', diagram: 'szinek', question: 'Mely sz√≠n t√°mogatja a gy√≥gyul√°st?', multiple: true },
    { id: 29, name: 'Krist√°lyok', icon: 'üíé', diagram: 'kristaly', question: 'Mely krist√°ly seg√≠t az integr√°ci√≥ban?', multiple: true },
    { id: 30, name: 'Z√°r√≥ m√©r√©s', icon: 'üìà', diagram: 'szazalek', question: 'Mennyire er≈ës a blokk most? (0-100%)' },
    { id: 31, name: 'Old√≥ Sz√∂vegek', icon: 'üìñ' },
    { id: 32, name: 'Lez√°r√°s', icon: 'üôè' }
];

const diagrams = {
    igenNem: { 
        title: 'Igen - Nem - Nem most', 
        options: ['IGEN', 'NEM', 'NEM MOST'],
        colors: ['#bbf7d0', '#fecaca', '#fde68a']
    },
    szazalek: { 
        title: 'Sz√°zal√©kos m√©r√©s', 
        options: ['0%','10%','20%','30%','40%','50%','60%','70%','80%','90%','100%'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe']
    },
    eletterulet: { 
        title: '√âletter√ºletek', 
        options: ['Munka/Karrier', 'P√©nz√ºgyek', 'Szerelem/P√°rkapcsolat', 'Csal√°d', 'Eg√©szs√©g', 'Bar√°ts√°gok', 'Spiritualit√°s', 'Otthon/Lakhat√°s', 'Szabadid≈ë/Hobbik', 'Kreativit√°s/Alkot√°s', '√ñn√©rt√©kel√©s/√ñnbizalom', 'Szexualit√°s/Intimit√°s', 'Tanul√°s/Fejl≈ëd√©s', 'Kommunik√°ci√≥', 'C√©ltudatoss√°g/J√∂v≈ëk√©p'],
        colors: ['#fecaca','#fed7aa','#fde68a','#d9f99d','#bbf7d0','#99f6e4','#bfdbfe','#c7d2fe','#ddd6fe','#e9d5ff','#fbcfe8','#fca5a5','#a7f3d0','#fef3c7','#c7d2fe']
    },
    erzelmGyoker: {
        title: '√ârzelmi Gy√∂k√©r',
        options: ['F√©lelem/Szorong√°s', 'Harag/D√ºh', 'Szomor√∫s√°g/Gy√°sz', '√ñr√∂m (elfojtott)', 'Szeretet (hi√°nya)', 'Bizalom (hi√°nya)', 'B≈±ntudat', 'Sz√©gyen', 'Megvet√©s', 'Undor', 'Meglepet√©s (trauma)', 'V√°gy/Hi√°ny', '√ârzelmi zsibbad√°s', 'F√°jdalom', 'Rejtett v√°gy', 'Tehetetlens√©g', 'Elfojtott d√ºh', 'Mag√°ny'],
        colors: ['#fca5a5', '#fecaca', '#bfdbfe', '#fde68a', '#fbcfe8', '#d1d5db', '#fed7aa', '#fcd34d', '#ddd6fe', '#99f6e4', '#fef3c7', '#f9a8d4', '#e5e7eb', '#fca5a5', '#f5d0fe', '#fecdd3', '#fed7aa', '#c7d2fe']
    },
    erzelem: { 
        title: 'Negat√≠v √ârzelmek', 
        options: ['Harag/D√ºh', 'Szomor√∫s√°g/B√°nat', 'F√©lelem/Aggodalom', 'B≈±ntudat/Sz√©gyen', 'Frusztr√°ci√≥', 'Irigys√©g', 'Elhagyatotts√°g', 'Rem√©nytelens√©g', 'K√©ts√©gbees√©s', 'Kishit≈±s√©g', 'Befel√© ford√≠tott d√ºh', 'Megkesered√©s'],
        colors: ['#fecaca','#fca5a5','#fcd5d5','#fed7aa','#fecaca','#fca5a5','#fecdd3','#fca5a5','#fed7aa','#fcd5d5','#fecaca','#fca5a5']
    },
    trauma: {
        title: 'Trauma M√©ly√≠t√©s',
        options: ['Gyerekkori trauma', 'B√°ntalmaz√°s', 'Elhanyagol√°s', 'Szexu√°lis trauma', '√ârzelmi manipul√°ci√≥', 'Csal√°di konfliktus', 'V√°l√°s', 'Hal√°leset', 'Vesztes√©g', 'Baleset', 'Betegs√©g', 'Iskolai b√°ntalmaz√°s', 'El√°rul√°s', 'Ism√©tl≈ëd≈ë kudarc', '√ñr√∂kl√∂tt trauma', 'Orvosi beavatkoz√°s', 'Term√©szeti katasztr√≥fa', 'H√°bor√∫s trauma', 'Sz√ºl√©si trauma'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fecaca','#fca5a5','#fcd5d5','#fed7aa','#fecaca','#fca5a5','#fcd5d5','#fecdd3','#fed7aa','#fde68a','#fecaca','#fca5a5']
    },
    lelkiSerules: {
        title: 'Lelki S√©r√ºl√©sek',
        options: ['Elutas√≠t√°s', 'Elhagy√°s', 'Megal√°z√°s', '√Årul√°s', 'Igazs√°gtalans√°g', 'L√°thatatlans√°g', 'Meg nem hallgat√°s', '√ârzelmi elhanyagol√°s', 'Fizikai elhanyagol√°s', 'T√∫lv√©d√©s', 'Hat√°rok √°tl√©p√©se', 'Gyermekk√©nt kezel√©s', 'Sz√ºl≈ëi szerep r√°k√©nyszer√≠t√©se', 'B≈±nbakk√©pz√©s', 'Kirekeszt√©s', '√ârzelmi zsarol√°s', 'Val√≥s√°g tagad√°sa', '√Ålland√≥ kritika', '√ñsszehasonl√≠t√°s', 'Felt√©teles szeretet', 'Meg nem √©rt√©s', 'T√∫lterhel√©s', 'Manipul√°ci√≥'],
        colors: ['#fca5a5', '#fcd34d', '#fdba74', '#d8b4fe', '#bfdbfe', '#a5f3fc', '#99f6e4', '#bbf7d0', '#fde68a', '#fecaca', '#ddd6fe', '#e9d5ff', '#fbcfe8', '#fecdd3', '#fed7aa', '#fef3c7', '#ccfbf1', '#c7d2fe', '#ddd6fe', '#fbcfe8', '#a7f3d0', '#fcd5d5', '#e9d5ff']
    },
    kapcsolat: {
        title: 'Kapcsolati Gy√∂k√©r',
        options: ['√ân magam', 'Anya', 'Apa', 'Testv√©r', 'Gyerek', 'Partner', 'H√°zast√°rs', 'Volt partner', 'Bar√°t', 'Koll√©ga', 'F≈ën√∂k', 'Tan√°r', 'Mentor', 'Nagysz√ºl≈ë', 'Rokon', 'Isten/Magasabb √ân', 'El≈ëz≈ë gener√°ci√≥/≈ês√∂k'],
        colors: ['#e9d5ff','#fbcfe8','#bfdbfe','#bbf7d0','#fde68a','#fecaca','#fca5a5','#fcd5d5','#a7f3d0','#c7d2fe','#e9d5ff','#ddd6fe','#d8b4fe','#fed7aa','#fcd34d','#f5d0fe','#c7d2fe']
    },
    eredet: {
        title: 'Blokk Eredete',
        options: ['0-3 √©v', '3-7 √©v', '7-14 √©v', '14-21 √©v', '21-35 √©v', '35-50 √©v', '50+ √©v', 'M√©hen bel√ºl', 'Sz√ºlet√©s', 'Korai gyerek', 'Iskol√°s kor', 'Pubert√°s', 'Fiatal feln≈ëtt', 'M√∫lt √©let', 'Gener√°ci√≥s'],
        colors: ['#fecaca','#fed7aa','#fde68a','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#fca5a5','#fcd5d5','#fecaca','#fed7aa','#fde68a','#d9f99d','#ddd6fe','#e9d5ff']
    },
    hiedelem: { 
        title: 'Korl√°toz√≥ Hiedelmek', 
        options: ['Nem vagyok el√©g j√≥', 'Nem √©rdemlem meg', 'Nem vagyok szerethet≈ë', 'Gyenge vagyok', 'Mindig kudarcot vallok', 'Vesz√©lyes a siker', 'Nem lehetek boldog', 'Nem vagyok tehets√©ges', 'Sosem v√°ltozhatok', 'Nem √©rdemlem meg a sikert', 'Vesz√©lyes kifejezni magam', 'Mindig beteg vagyok', 'Nem b√≠zhatok senkiben', 'A p√©nz rossz'],
        colors: ['#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb','#d1d5db','#e5e7eb']
    },
    test: { 
        title: 'Testt√°j√©kok', 
        options: ['Fej/Agy', 'Torok/Nyak', 'Sz√≠v/Mellkas', 'Gyomor/Has', 'M√°j/Epeh√≥lyag', 'Vese', 'H√°t/Gerinc', 'Der√©k/√Ågy√©k', 'Cs√≠p≈ë/Medence', 'V√©gtagok'],
        colors: ['#e9d5ff','#ddd6fe','#d8b4fe','#e9d5ff','#f3e8ff','#d8b4fe','#ddd6fe','#e9d5ff','#e0d5f5','#d4c5f9']
    },
    csakra: {
        title: 'Csakr√°k',
        options: ['Gy√∂k√©r csakra', 'Szakr√°lis csakra', 'Napfonat csakra', 'Sz√≠v csakra', 'Torok csakra', '3. szem', 'Korona csakra'],
        colors: ['#fecaca','#fed7aa','#fde68a','#bbf7d0','#bfdbfe','#ddd6fe','#e9d5ff']
    },
    blokkJelleg: {
        title: 'Blokk Jellege',
        options: ['√ârzelmi blokk', 'Ment√°lis blokk', 'Fizikai blokk', 'Energetikai blokk', 'Spiritu√°lis blokk', 'Karmikus blokk', 'Lelki blokk', 'Csal√°di blokk', '≈êsi/Ancestr√°lis blokk', 'T√°rsadalmi/Kollekt√≠v blokk', 'Kapcsolati blokk'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#a7f3d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe']
    },
    vedekezes: {
        title: 'V√©dekez√©si Mechanizmus',
        options: ['Tagad√°s', 'Elfojt√°s', 'Kivet√≠t√©s', '√âsszer≈±s√≠t√©s', 'Kompenz√°ci√≥', 'Elker√ºl√©s', 'Agresszi√≥', 'T√∂k√©letess√©gre t√∂rekv√©s', 'Kontroll', 'F√ºgg≈ës√©g', 'Disszoci√°ci√≥/Lev√°l√°s', 'Humor', 'T√∫lgondol√°s', '√Åbr√°ndoz√°s/Menek√ºl√©s', 'Burkolt agresszi√≥', '√ârzelmi t√°vols√°gtart√°s'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fef9d5','#d9f99d','#bbf7d0','#d9f99d','#a7f3d0','#99f6e4','#fcd5d5','#e5e7eb']
    },
    szerepek: {
        title: '√âletszerepek',
        options: ['Sz√ºl≈ë szerepben', 'Partner szerepben', 'Munkav√°llal√≥', 'Vezet≈ë szerepben', 'Gyerek szerepben', 'Bar√°t szerepben', 'Koll√©ga szerepben', 'Egyed√ºl/Mag√°n√©let', 'K√∂z√∂ss√©gben', 'Alkot√≥/Kreat√≠v', 'Gyermekk√©nt a sz√ºleim el≈ëtt', 'Spiritu√°lis/Tan√≠t√≥ szerepben', 'Seg√≠t≈ë/Gy√≥gy√≠t√≥ szerepben'],
        colors: ['#fbcfe8','#fecaca','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#99f6e4','#bfdbfe','#c7d2fe','#e9d5ff','#f5d0fe','#ddd6fe','#a7f3d0']
    },
    szabotazs: {
        title: 'Szabot√°zs Mint√°k',
        options: ['Halogat√°s', 'T√∂k√©letes√≠t√©s', 'F√©lbehagy√°s', '√ñnkritika', 'T√∫lv√°llal√°s', 'Kontroll ig√©nye', '√ñsszehasonl√≠t√°s', 'K√ºzdelem', 'Gyors felad√°s', 'Menek√ºl√©s', 'Nincs szabot√°zs'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fef9d5','#d9f99d','#bbf7d0']
    },
    haszon: {
        title: 'M√°sodlagos Haszon',
        options: ['Biztons√°got ad', 'Identit√°st ad', 'Figyelmet kapok', 'Szeretetet kapok', 'Nem kell v√°ltoznom', 'Nem kell felel≈ëss√©g', 'Elker√ºl√∂m a kudarcot', 'V√©delmez m√°sok el≈ël', 'Igazol engem', 'Nem kell teljes√≠tenem', 'Sajn√°lnak/Egy√ºtt√©rz√©st kapok'],
        colors: ['#fde68a','#fed7aa','#fecaca','#fbcfe8','#f5d0fe','#e9d5ff','#ddd6fe','#d8b4fe','#c7d2fe','#bfdbfe','#fef3c7']
    },
    fogadalom: {
        title: 'Fogadalmak',
        options: ['Soha nem leszek mint ≈ë', 'Mindig v√©deni fogom magam', 'Soha nem engedem meg', 'Mindig er≈ës leszek', 'Soha nem b√≠zom', 'Mindig egyed√ºl csin√°lom', 'Soha nem fogok s√≠rni', 'Mindig kontroll alatt', '√ñr√∂k h≈±s√©g', 'Csal√°di fogadalom', 'Vall√°si fogadalom', 'L√©lek szerz≈ëd√©s', 'Soha nem leszek boldog', 'Mindig √°ldozat leszek', 'Nem √©rdemlem meg a j√≥t', 'Nincs fogadalom'],
        colors: ['#fca5a5','#fcd5d5','#fecaca','#fecdd3','#fca5a5','#fed7aa','#fde68a','#fef3c7','#fbcfe8','#ddd6fe','#d8b4fe','#a5f3fc','#fcd5d5','#fca5a5','#fed7aa','#bbf7d0']
    },
    mikroszkop: {
        title: 'Mikroszk√≥p - Tov√°bbi r√©szletek',
        options: ['Csal√°di minta', 'T√°rsadalmi kondicion√°l√°s', 'Kultur√°lis elv√°r√°s', 'Nemi szerep', 'Vall√°si tan√≠t√°s', 'Iskolai tapasztalat', 'M√©dia hat√°s', 'Kort√°rs nyom√°s', 'T√∂rt√©nelmi trauma', 'Kollekt√≠v tudattalan', 'Ancestr√°lis √°t√∂r√∂k√≠t√©s', 'Lelki szerz≈ëd√©s', 'Energetikai kapcsolat', 'Karmikus lenyomat', 'T√°rsl√©lek befoly√°s', 'Entit√°s attachment', '√Åtkok/√Åtkoz√°sok', 'Nincs t√∂bb r√©szlet'],
        colors: ['#fecaca','#fed7aa','#fde68a','#fef3c7','#d9f99d','#bbf7d0','#99f6e4','#a5f3fc','#bfdbfe','#c7d2fe','#ddd6fe','#e9d5ff','#f5d0fe','#fecdd3','#fbcfe8','#fca5a5','#fed7aa','#bbf7d0']
    },
    pozitivErzelem: {
        title: 'Pozit√≠v √ârzelmek',
        options: ['√ñr√∂m', 'B√©ke', 'Szeretet', 'H√°la', 'Szabads√°g', 'Bizalom', 'B√°tors√°g', 'Rem√©ny', 'Lelkesed√©s', 'Megel√©gedetts√©g', 'Biztons√°g', 'K√∂nnyeds√©g'],
        colors: ['#fef3c7','#fef9d5','#fef3c7','#fde68a','#fed7aa','#fcd34d','#fef3c7','#fef9d5','#fef9c3','#d9f99d','#bbf7d0','#d9f99d']
    },
    ujHit: {
        title: '√öj Hiedelmek',
        options: ['El√©g j√≥ vagyok', 'Meg√©rdemlem a j√≥t', 'Szerethet≈ë vagyok', 'Er≈ës vagyok', 'Sikereket √©rek el', 'Biztons√°gos a siker', 'Boldog lehetek', 'Tehets√©ges vagyok', 'V√°ltozhatok √©s fejl≈ëdhetek', 'B√≠zom magamban', 'Elfogadom magam', 'Megbocs√°tok magamnak'],
        colors: ['#bbf7d0','#a7f3d0','#99f6e4','#99f6e4','#a5f3fc','#bfdbfe','#a5f3fc','#bfdbfe','#c7d2fe','#bfdbfe','#c7d2fe','#ddd6fe']
    },
    szinek: {
        title: 'Gy√≥gy√≠t√≥ Sz√≠nek',
        options: ['Feh√©r (tisztas√°g)', 'Arany (b√∂lcsess√©g)', 'Ez√ºst (intu√≠ci√≥)', 'Lila (spiritualit√°s)', 'K√©k (kommunik√°ci√≥)', 'Z√∂ld (gy√≥gyul√°s)', 'R√≥zsasz√≠n (szeretet)', 'Narancss√°rga (kreativit√°s)', 'S√°rga (√∂r√∂m)', 'T√ºrkiz (v√©delem)', 'Fekete (v√©delem/f√∂ldel√©s)'],
        colors: ['#fafafa','#fef3c7','#e5e7eb','#e9d5ff','#bfdbfe','#bbf7d0','#fbcfe8','#fed7aa','#fef3c7','#99f6e4','#374151']
    },
    kristaly: {
        title: 'Gy√≥gy√≠t√≥ Krist√°lyok',
        options: ['Hegyikrist√°ly', '√ìnix', 'Szodalit', 'Tigrisszem', 'R√≥zsakvarc', 'Hematit', 'Ametiszt', 'Aventurin', 'Ach√°t', 'Citrin', 'Karneol', 'Holdk≈ë', 'J√°spis', 'Howlit', 'Cseresznyekvarc', 'Obszidi√°n'],
        colors: ['#e5e7eb','#2d3748','#93c5fd','#fcd34d','#fbcfe8','#6b7280','#ddd6fe','#86efac','#d1d5db','#fef3c7','#fed7aa','#f3f4f6','#fca5a5','#fecdd3','#fbb6ce','#4a5568']
    }
};

function init() {
    renderStepsGrid();
    loadStep(0);
}

function renderStepsGrid() {
    const grid = document.getElementById('stepsGrid');
    grid.innerHTML = steps.map((step, i) => {
        let className = 'step-icon pending';
        if (i === currentStep) className = 'step-icon active';
        else if (completedSteps.includes(i)) className = 'step-icon completed';
        return '<div class="' + className + '" onclick="jumpToStep(' + i + ')" title="' + step.name + '">' + step.icon + '</div>';
    }).join('');
    
    const percent = Math.round((currentStep / steps.length) * 100);
    document.getElementById('stepInfo').textContent = currentStep + '/' + steps.length + ' l√©p√©s';
    document.getElementById('percentInfo').textContent = percent + '%';
    document.getElementById('progressBar').style.width = percent + '%';
}

function loadStep(stepIndex) {
    currentStep = stepIndex;
    selectedOptions = [];
    renderStepsGrid();
    
    const step = steps[stepIndex];
    const card = document.getElementById('contentCard');
    
    let html = '<h2>' + step.icon + ' ' + step.name + '</h2>';
    
    switch(stepIndex) {
        case 0:
            html += '<div class="info-box purple"><p><strong>√údv√∂z√∂llek a blokkold√≥ folyamatban!</strong></p><p style="margin-top: 12px;">K√©sz√ºljetek fel a munk√°ra: keressetek egy csendes helyet, vegyetek m√©ly l√©legzeteket, √©s nyiss√°tok meg magatokat a v√°ltoz√°sra.</p><p style="margin-top: 12px;">A kezel≈ë v√©gigk√≠s√©ri a klienst minden l√©p√©sen, megbesz√©lik a kapott √©rt√©keket √©s k√∂z√∂sen dolgoznak a blokk felold√°s√°n.</p></div><div class="info-box blue" style="margin-top: 16px;"><label style="display: block; margin-bottom: 8px; font-weight: 600;">Kliens neve (opcion√°lis):</label><input type="text" id="clientName" placeholder="N√©v megad√°sa..." value="' + sessionData.clientName + '"></div><button class="btn btn-purple" onclick="saveClientName(); nextStep();">Kezdj√ºk! ‚Üí</button>';
            break;
            
        case 17:
            html += '<div class="info-box purple"><p><strong>TEM M√©r√©s - H√°rom dimenzi√≥ vizsg√°lata</strong></p><p style="margin-top: 12px;">M√©rd meg az ing√°val, hogy melyik szinten milyen er≈ës a blokk:</p></div><div class="slider-container"><div class="slider-group"><label>ü´Ä Testi szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Testi + '" class="slider" id="testiSlider" oninput="updateSliderValue(\'Testi\')"><span class="slider-value" id="testiValue">' + sessionData.temValues.Testi + '%</span></div></div><div class="slider-group"><label>üí≠ √ârzelmi szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Erzelmi + '" class="slider" id="erzelmiSlider" oninput="updateSliderValue(\'Erzelmi\')"><span class="slider-value" id="erzelmiValue">' + sessionData.temValues.Erzelmi + '%</span></div></div><div class="slider-group"><label>üß† Ment√°lis szint (0-100%)</label><div class="slider-wrapper"><input type="range" min="0" max="100" value="' + sessionData.temValues.Mentalis + '" class="slider" id="mentalisSlider" oninput="updateSliderValue(\'Mentalis\')"><span class="slider-value" id="mentalisValue">' + sessionData.temValues.Mentalis + '%</span></div></div></div><div class="btn-grid"><button class="btn btn-secondary" onclick="prevStep()">‚Üê Vissza</button><button class="btn btn-purple" onclick="saveTEM()">Ment√©s √©s tov√°bb ‚Üí</button></div>';
            break;
            
        case 25:
            html += '<div class="info-box yellow"><p><strong>Most k√∂vetkezik az old√°s pillanata!</strong></p><p style="margin-top: 12px;">A kezel≈ë k√©ri az ing√°t, hogy oldja fel a blokkot. Figyelj√©tek meg egy√ºtt a mozg√°st, √©s v√°rj√°tok meg, am√≠g meg√°ll.</p></div><div class="info-box green" style="margin-top: 16px;"><p style="text-align: center; font-size: 1.1rem;">‚ú® <em>"Elengedem ezt a blokkot. Szabadd√° v√°lok. K√∂sz√∂n√∂m a tanuls√°got, ami m√∂g√∂tte rejlett."</em></p></div><button class="btn btn-purple" onclick="nextStep()">Old√°s megt√∂rt√©nt ‚Üí</button>';
            break;
            
        case 31:
            generateReleasingText();
            generateIntegratingText();
            html += '<div class="info-box purple"><p><strong>Old√≥ √©s integr√°l√≥ affirm√°ci√≥k</strong></p><p style="margin-top: 8px;">A kezel≈ë felolvassa az al√°bbi sz√∂vegeket a kliensnek, majd k√∂z√∂sen √°tbesz√©lik ≈ëket. A sz√∂vegek szerkeszthet≈ëk.</p></div>';
            html += '<h3 style="margin-top: 24px; color: #7e22ce;">üìñ Old√≥ sz√∂veg:</h3>';
            html += '<textarea id="releasingTextArea" style="min-height: 200px;">' + sessionData.releasingTexts + '</textarea>';
            html += '<h3 style="margin-top: 24px; color: #7e22ce;">üí´ Integr√°l√≥ sz√∂veg:</h3>';
            html += '<textarea id="integratingTextArea" style="min-height: 200px;">' + sessionData.integratingTexts + '</textarea>';
            html += '<button class="btn btn-purple" onclick="saveTexts(); nextStep()">Ment√©s √©s folytat√°s ‚Üí</button>';
            break;
            
        case 32:
            html += '<div class="info-box green"><p><strong>üéâ A blokkold√≥ kezel√©s befejez≈ëd√∂tt!</strong></p><p style="margin-top: 8px;">A kezel≈ë most elk√©sz√≠ti a kezel≈ëlapot, amit √°tad a kliensnek √©s megtart mag√°nak dokument√°ci√≥k√©nt.</p></div>';
            html += '<div class="summary-section"><h3>üìä Munkamenet √∂sszefoglal√≥</h3>';
            html += '<p><strong>Kliens:</strong> ' + (sessionData.clientName || 'N/A') + '</p>';
            html += '<p><strong>Kezdeti m√©r√©s:</strong> ' + (sessionData.measurements.initial || 'N/A') + '</p>';
            html += '<p><strong>Z√°r√≥ m√©r√©s:</strong> ' + (sessionData.measurements.final || 'N/A') + '</p>';
            if (sessionData.measurements.initial && sessionData.measurements.final) {
                const improvement = parseInt(sessionData.measurements.initial.replace('%','')) - parseInt(sessionData.measurements.final.replace('%',''));
                html += '<p><strong>V√°ltoz√°s:</strong> ' + (improvement > 0 ? '-' : '+') + Math.abs(improvement) + '% ' + (improvement > 0 ? '‚úÖ' : '‚ö†Ô∏è') + '</p>';
            }
            html += '<p style="margin-top: 16px;"><strong>TEM √©rt√©kek:</strong></p>';
            html += '<p>‚Ä¢ Testi: ' + sessionData.temValues.Testi + '%</p>';
            html += '<p>‚Ä¢ √ârzelmi: ' + sessionData.temValues.Erzelmi + '%</p>';
            html += '<p>‚Ä¢ Ment√°lis: ' + sessionData.temValues.Mentalis + '%</p>';
            
            if (Object.keys(sessionData.answers).length > 0) {
                html += '<p style="margin-top: 16px;"><strong>Kiemelt v√°laszok:</strong></p>';
                for (let stepId in sessionData.answers) {
                    const step = steps[stepId];
                    if (step && sessionData.answers[stepId]) {
                        html += '<p>‚Ä¢ <em>' + step.name + ':</em> ' + sessionData.answers[stepId] + '</p>';
                    }
                }
            }
            html += '</div>';
            html += '<button class="btn btn-download" onclick="saveSessionDOCX()">üíæ Kezel≈ëlap ment√©se (.doc)</button>';
            html += '<button class="btn btn-purple" style="margin-top: 16px;" onclick="confirmFinish()">‚ú® √öj kezel√©s ind√≠t√°sa</button>';
            break;
            
        default:
            if (step.diagram) {
                html += '<div class="question-box">‚ùì ' + step.question + '</div>';
                html += '<div class="info-box blue"><p>Haszn√°ld az ing√°t a v√°lasz megtal√°l√°s√°hoz. ' + (step.multiple ? 'T√∂bb opci√≥ is kiv√°laszthat√≥.' : '') + '</p></div>';
                html += '<button class="btn btn-primary" onclick="openDiagram(\'' + step.diagram + '\', ' + step.multiple + ')">Ing√°s m√©r√©s ‚Üí</button>';
                if (sessionData.answers[stepIndex]) {
                    html += '<div class="answer-display"><div class="answer-label">V√°lasz:</div><div class="answer-value">' + sessionData.answers[stepIndex] + '</div></div>';
                }
            } else {
                html += '<div class="info-box purple"><p>Folytass√°tok a k√∂vetkez≈ë l√©p√©ssel.</p></div><button class="btn btn-purple" onclick="nextStep()">Tov√°bb ‚Üí</button>';
            }
    }
    
    card.innerHTML = html;
    
    const navCard = document.getElementById('navigationCard');
    if (stepIndex > 0 && stepIndex < steps.length - 1 && stepIndex !== 17 && stepIndex !== 31) {
        navCard.style.display = 'block';
    } else {
        navCard.style.display = 'none';
    }
}

function saveClientName() {
    const nameInput = document.getElementById('clientName');
    if (nameInput) {
        sessionData.clientName = nameInput.value.trim();
    }
}

function updateSliderValue(type) {
    const slider = document.getElementById(type.toLowerCase() + 'Slider');
    const valueDisplay = document.getElementById(type.toLowerCase() + 'Value');
    valueDisplay.textContent = slider.value + '%';
}

function saveTEM() {
    sessionData.temValues.Testi = parseInt(document.getElementById('testiSlider').value);
    sessionData.temValues.Erzelmi = parseInt(document.getElementById('erzelmiSlider').value);
    sessionData.temValues.Mentalis = parseInt(document.getElementById('mentalisSlider').value);
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    nextStep();
}

function saveTexts() {
    sessionData.releasingTexts = document.getElementById('releasingTextArea').value;
    sessionData.integratingTexts = document.getElementById('integratingTextArea').value;
}

function createCircleDiagram(diag, type) {
    const opts = diag.options;
    const colors = diag.colors;
    const angleStep = 360 / opts.length;
    const centerX = 300, centerY = 300, radius = 250;
    
    let paths = '';
    
    opts.forEach(function(opt, i) {
        const angle1 = (i * angleStep - 90) * Math.PI / 180;
        const angle2 = ((i + 1) * angleStep - 90) * Math.PI / 180;
        const x1 = centerX + radius * Math.cos(angle1);
        const y1 = centerY + radius * Math.sin(angle1);
        const x2 = centerX + radius * Math.cos(angle2);
        const y2 = centerY + radius * Math.sin(angle2);
        
        const midAngle = (angle1 + angle2) / 2;
        const textRadius = radius * 0.65;
        const textX = centerX + textRadius * Math.cos(midAngle);
        const textY = centerY + textRadius * Math.sin(midAngle);
        
        let rotationAngle = (midAngle * 180 / Math.PI);
        
        const escaped = opt.replace(/'/g, '&#39;');
        const textLen = opt.length;
        const fontSize = textLen > 25 ? 10 : (textLen > 20 ? 11 : (textLen > 15 ? 12 : (textLen > 10 ? 13 : 14)));
        
        paths += '<path class="diagram-sector" d="M' + centerX + ',' + centerY + ' L' + x1 + ',' + y1 + ' A' + radius + ',' + radius + ' 0 0,1 ' + x2 + ',' + y2 + ' Z" fill="' + colors[i] + '" onclick="toggleOption(\'' + escaped + '\', ' + steps[currentStep].multiple + ')" style="cursor: pointer; transition: all 0.2s; stroke: #fff; stroke-width: 2;" onmouseover="this.style.opacity=0.8; this.style.strokeWidth=3;" onmouseout="this.style.opacity=1; this.style.strokeWidth=2;" />';
        paths += '<text x="' + textX + '" y="' + textY + '" font-size="' + fontSize + '" text-anchor="middle" dominant-baseline="middle" transform="rotate(' + rotationAngle + ' ' + textX + ' ' + textY + ')" style="pointer-events: none; font-weight: bold; fill: #1f2937; text-shadow: 0px 0px 4px rgba(255,255,255,0.9);">' + opt + '</text>';
    });
    
    return '<svg viewBox="0 0 600 600" style="width: 100%; max-width: 600px; height: auto; margin: 20px auto; display: block;">' + paths + '</svg>';
}

function openDiagram(type, isMultiple) {
    const diag = diagrams[type];
    if (!diag) return;
    
    const step = steps[currentStep];
    document.getElementById('diagramTitle').textContent = diag.title;
    document.getElementById('diagramQuestion').textContent = step.question || '';
    
    // Restore previously selected options
    if (sessionData.answers[currentStep]) {
        selectedOptions = sessionData.answers[currentStep].split(', ');
    } else {
        selectedOptions = [];
    }
    
    let html = createCircleDiagram(diag, type);
    html += '<div class="diagram-grid" style="margin-top: 24px;">';
    diag.options.forEach(function(opt) {
        const isSelected = selectedOptions.includes(opt);
        const selectedClass = isSelected ? ' selected' : '';
        html += '<button class="diagram-button' + selectedClass + '" onclick="toggleOption(\'' + opt.replace(/'/g, "&#39;") + '\', ' + isMultiple + ')">' + opt + '</button>';
    });
    html += '</div>';
    
    if (isMultiple) {
        html += '<button class="btn btn-purple" style="margin-top: 16px;" onclick="saveMultipleOptions()">Kiv√°laszt√°s ment√©se</button>';
        html += '<button class="btn btn-skip" style="margin-top: 8px;" onclick="skipDiagram()">Kihagy√°s</button>';
    } else {
        html += '<button class="btn btn-skip" style="margin-top: 16px;" onclick="skipDiagram()">Kihagy√°s</button>';
    }
    html += '<button class="btn btn-secondary" style="margin-top: 8px;" onclick="closeDiagram()">Bez√°r√°s</button>';
    
    document.getElementById('diagramContent').innerHTML = html;
    document.getElementById('diagramModal').classList.add('active');
}

function toggleOption(option, isMultiple) {
    const index = selectedOptions.indexOf(option);
    
    if (isMultiple) {
        // Multiple selection mode
        if (index > -1) {
            selectedOptions.splice(index, 1);
        } else {
            selectedOptions.push(option);
        }
        // Update button states
        const buttons = document.querySelectorAll('.diagram-button');
        buttons.forEach(btn => {
            if (btn.textContent === option) {
                btn.classList.toggle('selected');
            }
        });
    } else {
        // Single selection mode - save immediately
        if (currentStep === 2) {
            sessionData.measurements.initial = option;
        } else if (currentStep === 14) {
            // TEM - Testi
            sessionData.temValues.Testi = parseInt(option);
        } else if (currentStep === 15) {
            // TEM - √ârzelmi
            sessionData.temValues.Erzelmi = parseInt(option);
        } else if (currentStep === 16) {
            // TEM - Ment√°lis
            sessionData.temValues.Mentalis = parseInt(option);
        } else if (currentStep === 30) {
            sessionData.measurements.final = option;
        } else {
            sessionData.answers[currentStep] = option;
        }
        
        closeDiagram();
        
        if (!completedSteps.includes(currentStep)) {
            completedSteps.push(currentStep);
        }
        
        loadStep(currentStep);
    }
}

function saveMultipleOptions() {
    if (selectedOptions.length > 0) {
        sessionData.answers[currentStep] = selectedOptions.join(', ');
    }
    
    closeDiagram();
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    
    loadStep(currentStep);
}

function skipDiagram() {
    sessionData.answers[currentStep] = 'Kihagyva';
    
    closeDiagram();
    
    if (!completedSteps.includes(currentStep)) {
        completedSteps.push(currentStep);
    }
    
    loadStep(currentStep);
}

function closeDiagram() {
    document.getElementById('diagramModal').classList.remove('active');
}

function generateReleasingText() {
    let parts = [];
    
    parts.push("Elengedem ezt a blokkot, amely eddig visszatartott az √©letemben.");
    
    if (sessionData.answers[3]) {
        parts.push("Felszabadulok a(z) " + sessionData.answers[3].toLowerCase() + " ter√ºlet√©n m≈±k√∂d≈ë korl√°taimt√≥l.");
    }
    
    if (sessionData.answers[4] || sessionData.answers[5]) {
        const emotion = sessionData.answers[5] || sessionData.answers[4];
        parts.push("Elengedem a " + emotion.toLowerCase() + " √©rz√©s√©t, amely √°thatotta a l√©temet.");
    }
    
    if (sessionData.answers[6]) {
        parts.push("Gy√≥gy√≠tom a " + sessionData.answers[6].toLowerCase() + " nyomait.");
    }
    
    if (sessionData.answers[7]) {
        parts.push("Gy√≥gy√≠tom a " + sessionData.answers[7].toLowerCase() + " okozta sebeket.");
    }
    
    if (sessionData.answers[8]) {
        parts.push("B√©k√©ben elengedem azt, ami a " + sessionData.answers[8].toLowerCase() + " kapcsolat√°b√≥l eredt.");
    }
    
    if (sessionData.answers[10]) {
        parts.push("Nem hiszek tov√°bb abban, hogy \"" + sessionData.answers[10].toLowerCase() + "\".");
    }
    
    if (sessionData.answers[18]) {
        parts.push("Nem sz√ºks√©ges t√∂bb√© a " + sessionData.answers[18].toLowerCase() + ", v√©dtelen vagyok √©s ez rendben van.");
    }
    
    if (sessionData.answers[20] && sessionData.answers[20] !== 'Nincs szabot√°zs') {
        parts.push("Elengedem az √∂nszabot√°zs mint√°t: " + sessionData.answers[20].toLowerCase() + ".");
    }
    
    if (sessionData.answers[21]) {
        parts.push("Felismerem √©s elengedem a m√°sodlagos hasznot: " + sessionData.answers[21].toLowerCase() + ".");
    }
    
    if (sessionData.answers[22] && sessionData.answers[22] !== 'Nincs fogadalom') {
        parts.push("Feloldom a fogadalmat: \"" + sessionData.answers[22].toLowerCase() + "\".");
    }
    
    parts.push("K√∂sz√∂n√∂m a tanuls√°got, amit ez a blokk hozott sz√°momra.");
    parts.push("Most szabadon engedem, √©s nyitott vagyok az √∫j lehet≈ës√©gekre.");
    
    sessionData.releasingTexts = parts.join('\n\n');
}

function generateIntegratingText() {
    let parts = [];
    
    parts.push("Elfogadom az √∫j val√≥s√°gomat, amelyben szabad √©s eg√©sz vagyok.");
    
    if (sessionData.answers[26]) {
        parts.push(sessionData.answers[26] + " t√∂lti el a sz√≠vemet √©s a testemet.");
    }
    
    if (sessionData.answers[27]) {
        parts.push("√öj hitem: " + sessionData.answers[27] + ".");
    }
    
    if (sessionData.answers[3]) {
        parts.push("A(z) " + sessionData.answers[3].toLowerCase() + " ter√ºlet√©n szabadon kibontakozom.");
    }
    
    if (sessionData.answers[8]) {
        parts.push("Eg√©szs√©ges √©s t√°pl√°l√≥ kapcsolatokat √©p√≠tek, szabadon √©s szeretettel.");
    }
    
    if (sessionData.answers[11]) {
        parts.push("A testem " + sessionData.answers[11].toLowerCase() + " ter√ºlete gy√≥gyul √©s er≈ës√∂dik.");
    }
    
    if (sessionData.answers[12]) {
        parts.push("A " + sessionData.answers[12].toLowerCase() + " harmoniz√°l√≥dik √©s √°ramlik bennem az energia.");
    }
    
    if (sessionData.answers[28]) {
        const szin = sessionData.answers[28].split('(')[0].trim();
        parts.push(szin + " f√©ny vesz k√∂r√ºl √©s gy√≥gy√≠t.");
    }
    
    if (sessionData.answers[29]) {
        parts.push(sessionData.answers[29] + " energi√°ja t√°mogat √©s er≈ës√≠t.");
    }
    
    parts.push("H√°l√°s vagyok a v√°ltoz√°s√©rt √©s az √∫j lehet≈ës√©gek√©rt.");
    parts.push("Bizalommal l√©pek el≈ëre az √©letemben, tudva, hogy meg√©rdemlem a j√≥t.");
    
    sessionData.integratingTexts = parts.join('\n\n');
}

function saveSessionDOCX() {
    // Make sure texts are generated
    if (!sessionData.releasingTexts) {
        generateReleasingText();
    }
    if (!sessionData.integratingTexts) {
        generateIntegratingText();
    }
    
    sessionData.timestamp = new Date().toISOString();
    const datum = new Date(sessionData.timestamp).toLocaleString('hu-HU');
    const clientInfo = sessionData.clientName || 'N/A';
    
    // Generate text report
    let report = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
    report += '                    ING√ÅS BLOKKOLD√ì KEZEL≈êLAP\n';
    report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    report += 'Kliens: ' + clientInfo + '\n';
    report += 'D√°tum: ' + datum + '\n\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'M√âR√âSEK\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'Kezdeti m√©r√©s: ' + (sessionData.measurements.initial || 'N/A') + '\n';
    report += 'Z√°r√≥ m√©r√©s: ' + (sessionData.measurements.final || 'N/A') + '\n';
    
    if (sessionData.measurements.initial && sessionData.measurements.final) {
        const initial = parseInt(sessionData.measurements.initial.replace('%',''));
        const final = parseInt(sessionData.measurements.final.replace('%',''));
        const change = initial - final;
        report += 'V√°ltoz√°s: ' + change + '%\n';
    }
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'TEM M√âR√âS (Testi-√ârzelmi-Ment√°lis)\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'Testi szint: ' + sessionData.temValues.Testi + '%\n';
    report += '√ârzelmi szint: ' + sessionData.temValues.Erzelmi + '%\n';
    report += 'Ment√°lis szint: ' + sessionData.temValues.Mentalis + '%\n';
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'FELT√ÅRT TER√úLETEK\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    for (let stepId in sessionData.answers) {
        const step = steps[stepId];
        if (step && sessionData.answers[stepId] && sessionData.answers[stepId] !== 'Kihagyva') {
            report += step.name + ': ' + sessionData.answers[stepId] + '\n';
        }
    }
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'OLD√ì SZ√ñVEG\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += sessionData.releasingTexts + '\n';
    
    report += '\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += 'INTEGR√ÅL√ì SZ√ñVEG\n';
    report += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
    report += sessionData.integratingTexts + '\n';
    
    report += '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
    report += '                        KEZEL√âS V√âGE\n';
    report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
    report += 'Kezel≈ë al√°√≠r√°sa: _______________________\n\n';
    report += 'Megjegyz√©sek:\n';
    report += '_______________________________________________________________\n';
    report += '_______________________________________________________________\n';
    
    // Create and download file
    try {
        const fileName = sessionData.clientName ? 
            'Kezelolap_' + sessionData.clientName.replace(/\s+/g, '_') + '_' + new Date().toISOString().slice(0,10) + '.doc' : 
            'Kezelolap_' + new Date().toISOString().slice(0,10) + '.doc';
        
        const blob = new Blob(['\uFEFF' + report], { type: 'application/msword;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = fileName;
        
        document.body.appendChild(a);
        a.click();
        
        setTimeout(function() {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('‚úÖ Kezel≈ëlap sikeresen mentve!\n\n' + fileName);
        }, 100);
    } catch (error) {
        console.error('Save error:', error);
        alert('‚ùå Hiba t√∂rt√©nt a ment√©s sor√°n. Pr√≥b√°ld √∫jra!');
    }
}

function nextStep() {
    if (currentStep < steps.length - 1) {
        if (!completedSteps.includes(currentStep)) {
            completedSteps.push(currentStep);
        }
        loadStep(currentStep + 1);
    }
}

function prevStep() {
    if (currentStep > 0) {
        loadStep(currentStep - 1);
    }
}

function jumpToStep(index) {
    loadStep(index);
}

function confirmFinish() {
    if (confirm('üôè √öj kezel√©st ind√≠tasz? A jelenlegi adatok elvesznek, ha nem mentetted el!')) {
        resetSession();
    }
}

function resetSession() {
    currentStep = 0;
    completedSteps = [];
    selectedOptions = [];
    sessionData = {
        answers: {},
        measurements: { initial: null, final: null },
        temValues: { Testi: 0, Erzelmi: 0, Mentalis: 0 },
        releasingTexts: '',
        integratingTexts: '',
        timestamp: null,
        clientName: ''
    };
    init();
}

init();
    </script>
</body>
</html>
    <!-- Authentication and PWA Logic -->
    <script>
// Valid access code hashes (SHA-256)
const validHashes = [
"a29be50615c7a06948f766cce616e52c079d9420594d689ced0878669b63c085",
"74859cc7971e9c0691216c2851d6d55014c843de1940732843ab140e73a635a3",
"7e679abf3f9b82c2119ff7cc8b6f56c565a05ba52c4cfd3bbcabf7abb08f1496",
"5caa49e416cb5ace6173b72596847d51037296e3976fe73404f66a5f25dbe01e",
"df5d6d45af1ef760fd1bace790e00a56f2d95da231df0207853f7a43509b6db8",
"02d8e9f664d7722b10205d70ef6211b4948470c71040d8369756e44d75c74d38",
"14c8924aa37c0eb95efa82879b58f82b31192255f19f5be2e98f0192328deca5",
"0e5645c57900614220c21ec65bd5694ef7ef3b79a0b2c3b13b77b0b58740442f",
"5cc655b727b7194d6c4e096bbf0c073664b001b62e448e57e661360fb525f117",
"71f297ddf86d66bfacebad2983bed9ca7e9720ae408758ffe7b9670f07ea4672"
];

// SHA-256 hash function
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return hashHex;
}


    <!-- Authentication and PWA Logic -->
    <script>
// Valid access code hashes (SHA-256) - 100 codes
const validHashes = [
"a29be50615c7a06948f766cce616e52c079d9420594d689ced0878669b63c085",
"74859cc7971e9c0691216c2851d6d55014c843de1940732843ab140e73a635a3",
"7e679abf3f9b82c2119ff7cc8b6f56c565a05ba52c4cfd3bbcabf7abb08f1496",
"5caa49e416cb5ace6173b72596847d51037296e3976fe73404f66a5f25dbe01e",
"df5d6d45af1ef760fd1bace790e00a56f2d95da231df0207853f7a43509b6db8",
"02d8e9f664d7722b10205d70ef6211b4948470c71040d8369756e44d75c74d38",
"14c8924aa37c0eb95efa82879b58f82b31192255f19f5be2e98f0192328deca5",
"0e5645c57900614220c21ec65bd5694ef7ef3b79a0b2c3b13b77b0b58740442f",
"5cc655b727b7194d6c4e096bbf0c073664b001b62e448e57e661360fb525f117",
"71f297ddf86d66bfacebad2983bed9ca7e9720ae408758ffe7b9670f07ea4672",
"173d3aff4b98ac2b729d65f28a57dc60c42d09025e0684555059e6309a1b90c7",
"2b1cabf9a6e4ce6337ba47b9243f905924992ee34df5e722078281adc73e824f",
"c0c828e28565d98a0b77526cfa3117eb490bc8a046b2e21d4c69538304b2c11b",
"4cbe6673f3a08651586f6b652dd9108fde16e3942e07f865e08792bf76cbb829",
"b645064aebe370f7b7497f250809c5855930d7a59842f1d3396c00c669010700",
"5f68caa02c178a3cc8fd81fa3ea3bd29ab054fbb967b29d4945b9fcad6f5d37e",
"e6cd9c951ac8e3afd64c6f11429f6a4d42b4f41b11de94171b37fafbfe5bc8e2",
"bb0a6f4ea832484204b94a4aefdb2b38a6f21660764adc03cd8488d6d55bbe30",
"aad2bcee8e7e8cf75dff5c2eb5752e0dd255737b204151420294f947b0d5eddc",
"9a71202f1045cda63f96e4ce3bc9cb2609efc9c462eff8b683d5faa75bfcc81f",
"25700f54b9bbcc9a7c887d745bc42921d0aeb0f8d3edc4cdb560a535c7ac44aa",
"280dfe4ec1ff8c8e9c0607280bd10f907f5197a5ddc1e672dfcb05ed4c50e342",
"274e2f5a94ccf6288afbb72c4eec6f907cb980bf19afb0776a4c45c9f9669bd3",
"4aef91ef46bb7c9c8c75f53f48bef74a1710756e065a7e28562803fb1d7fd48b",
"ec9be13a4d5e4a5bd79746f8a09e80c5b2c59eab9034163d41e24382fad24ae6",
"fad09def3283e3935406cdc9e99723910b60135702ce74c2cbc949857880e038",
"4c2d703f18d95ced33d715dfbe903792e16c8bf1047531eaf9b5dd724a7efc92",
"6c82a4ebdef0a8b92327523a9b952bbc69957aed11f4eca3c6d897ab33cd704e",
"f28f62450ad440f83a0e0b56da571fab25a4692b447f7abd0971801330cbefca",
"a5fce41c510ed21609a364b5cda4bd83e94373dfe918647de58200e7d39c400a",
"de105f208a127c5f88c33c1747affa5448f7ed5d121b905fe2b937ed679c50f0",
"e766aab01ac0d907e7f211d699446e7c663b2b362a5984c8780f4f4de711488d",
"6b7c5d2a9e8da6934f1f26cd8a504155784fe8563a560f3982cc718f3f9c7b83",
"97b2a1f71276709d6c90492b53c6f310cdf43ef7e198e32678fef15ab167250f",
"6228bbf60fccaf3e7d4f1703f671fa75ce93519e05b4e888bec2fc285873abe7",
"cea1142f8755fd18ab10d7c28e8efabb1d47d0378d9ba3836233fd06d3f72df5",
"3c51400c65d592b3fdc2995a53cd7a47a8402d8b58602227ecb257fe1f326f91",
"27f0ad7384542cf8301a5d2edd0df5a0515c989795693e73c82d85f8d877e5b0",
"6d28b09ea2582dfff002734667fbee04ca6260baa14bc5ca234532740903d1c9",
"a62c4a495f9eafec0185af5cd0aa94508f9bdc3a1709611a647fca2422522dc7",
"85001091c8132f31fdc4dc56c232e90644df3742fc40f87b7aef17350b4b0e36",
"57b849943fd0fd2215e3f3ecec62b7faadea81d143344faba8d8df5d809db4cb",
"6df52eb1f284c3e2fd61537c3242832872fffa09d9cf20f013922b3c43733ba4",
"b8f7e26585d9d5be6c232ea82337d7a3b256a021ca9876ba0407600514e89493",
"380526bbd32e13c868af92508e33b169da73c2c082126bd15b00b9f3ef2099dc",
"edabce497b6951321b6beaed7e110d30cad710c914d2466f7098aa1c6d6e15e8",
"60f3e3deb02ee2f541f1dd3478adf23647419eba0cf574f8583c139c18191a26",
"b42aa14910dac968ac1a4bd487223f2d87301f50bc763d349e3d63dafb893e3f",
"5a8bcb1b197b287b1aed2d9838d4dcc342cf1b8b7fdbcef5ebb114ad86086205",
"9e79ff0e80372cc8cad1905686ca302b06df7e14fe8100f24f8a6bbc0b8277a6",
"cacb3fa166625e41f91aee8d22fc3dc08e11d468d96d9be5188a40bd7382e832",
"3a72acc20319a46196dd2329a5026e44ad38b676fd4fae5f6c3db0d9ce614707",
"1e31108865106b6beadf7b590622a36548afb79f146bf27b2004a05817ce2e16",
"f81c33e48e2ecb615f404f85a912492c268dc821741ad6b3d42f7de54a65d51a",
"58f146f81f9e690e353e2f6febca1e3b3095ae96e79a23c6e1956f6a7dc13f2d",
"904ce6c780a13af1b149ab8fab12bc0c4e48c2a00dfb9cb9210230410a36c933",
"e76b6f13f5a2f7da624bd622e07fd1e8330b3256b72449c2990b441f2828fe11",
"68d309389971054c2bbb7846f48b07a296660b6d4000daa0456c6dd58b296b63",
"c8810b56ff958b05ebbdc8a1f76e1c96affd655e3b2ae87a6f0a431ed67756dd",
"192fde58d9c49fff777719f3434717b35fd0ce92ae37857ca8159a5458a489d3",
"d9ec055a86614e3fc4f198e148253d765fcf2f7674259e384410ed77ab654de1",
"ed9af78d3e95787399057486af7308020a88bab214685e26b5f87a71899c6035",
"6e3465e3981af82b5b694d06f8fcd50d105fd16b44a332fc3914190df4d78ac3",
"f921ad5b3f156f26930192ae78b76595cc3b9917328ac1c665d887acce8421d2",
"3679095fd7646a35bf68a549ccc1e323c58102eac52f8add54182f61f0bd39bb",
"d0280fee301f5f3813f9ea978518030b978b7abaa72dc4a4248fb3c0561524d4",
"ebf0bc3ba2d30e3b371240a7fa58c3ed88f02dd157119d166f8ac9536525b5a3",
"8c91a0195b7259dbe2a946fd7d74547baa1387981a785132443853e169bee872",
"5190d67534ff268d014c78d7467f55efca2cb8f4512b4d2b70ec9aad7a3d8982",
"8192ecd307bd785144aab6a2bfd69490270ac62da3bf1a16c5265ac219500599",
"3c6decb609bc3183d9e3902d178f30a41100f6fc658fb3357f247660e3d18723",
"4f19401f086434e37db6ee69011793ae8044d3aa245973b1d94520903d0bd6da",
"898e4df85ad71257f9f7a0cfc2adfd59f45c49c534cc24d08cbc87a815078a3b",
"7a2ccfebd976af0189da583f9f4af26c497e42526606c905a8899b78af16ee4b",
"615c89ba34e013fc37baf86f365f424d08ed4b71613ffc9dca290f5999dc3d56",
"5d75e706810d18fc9e725a950175cbf20c34f8fdb2dc5d91bd0e7a92418c2401",
"5f996029cbde71a292d2c01dd281a309118d4793e63e7d32f5b4c8adc244c5bb",
"f0821a0f0cf27c426ec17a67d6feebf4e9e40853c4ebba80c42bb47480efb8ea",
"81b0badc224748fd2929bd787a751eb5f28bdf8fb2c8a365cd426177a42a8772",
"fb025e6dacf723fb57f6ebea333531501ffcc746132845610623d334277af5ad",
"b751d2c8c9e6f169ef435fd77590212c178dfc08d66d296cc4bbff36b87766d5",
"d5eb954e8ddeb95c113e253071d268cbcdd90319a4a328d6c648f384266e7029",
"96729bd539ca29c4687bdf2a899a1f6303b510b48071c7cf8f84c75f1bdc98d1",
"0e8e1a97c53144b6be1b1b493495ffe0767c003a0f65b73eaff5d7762cd158f3",
"24bb7fef2d4ae3f59fc7359d687b62219f8f84d10a220f7aba0364b0cedc8970",
"caabfdbfd2b73410be2b287cbb8a4fcbf95bb8f7da01707d5c005de66a79023d",
"88afe2090e66ab28b2267f123e705a5024a7c9d9e8830ae130778378910ca32a",
"03c2ead0b7d85fce373aec41775922f80446019b5f70454e4e2179fdc41a6d99",
"dfff7205e45bd58e2569ccf1081c444e5bf398abd93e738888b2d593b1207fc5",
"d1fd3064481ed27b5d58cfdcd1e8c70a7d733ee88985e531e872f69a79358cec",
"06fce73a4c186a0f0a93ced7d56707d26a9e18b80b533ed81c2511ee2e584569",
"009ad2127ef972c2f179f028a8bb655a8cdf08d840b025eddd6cfa560e5f8cd2",
"6603de5c61e9ff5566ffeefd3b84949d5cbfa341ff8264104edea650c3d2e8ba",
"8ff86eff115f044128ec1718728f06e8b85d3073466b73e13e0f5d61b5dda7d3",
"87b6e78d51f3dd57f1aa3b864af5e3f2c75f6edf3dbf246741b51a057105e65b",
"57cf96c8ab15618f974b687a9fb0f9360dc0dfd174bae41e87f251a4b97c1dd3",
"4865af878beb3975077d21c9031c12e8a0b401ca03131c3b308df42b9d937439",
"4df10909befd70954828725b81be8e1fac3b21f3d147fbe212d91562d6665b0e",
"d89925e5f625e18c92016fa4b4dbffa0509ab545524eb2a66854a544576d6167",
"d3abe51dd424481957cf65540d1a5a0b971284bf5e38a5a9de18e3adcfd00d14"
];

// SHA-256 hash function
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    return hashHex;
}

// Check access on page load
window.addEventListener('DOMContentLoaded', function() {
    const hasAccess = localStorage.getItem('ibar_access');
    if (hasAccess === 'granted') {
        showApp();
    }
    
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js').catch(err => console.log('SW registration failed'));
    }
});

// Check access code
async function checkAccess() {
    const input = document.getElementById('accessCodeInput');
    const code = input.value.trim().toUpperCase();
    const errorDiv = document.getElementById('loginError');
    
    if (!code) {
        errorDiv.classList.add('show');
        return;
    }
    
    const hash = await sha256(code);
    
    if (validHashes.includes(hash)) {
        localStorage.setItem('ibar_access', 'granted');
        errorDiv.classList.remove('show');
        showApp();
    } else {
        errorDiv.classList.add('show');
        input.value = '';
    }
}

// Show app
function showApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appContainer').classList.add('active');
}

// Allow Enter key for login
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('accessCodeInput');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAccess();
            }
        });
    }
});
    </script>
</body>
</html>
